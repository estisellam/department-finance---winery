# ΧΧ—ΧΧ§Χ Χ›Χ΅Χ¤Χ™Χ - Χ¤Χ¨Χ•Χ™Χ§Χ Χ‘Χ΅Χ™Χ΅Χ™ Χ ΧΧ•Χ Χ™Χ

**Χ©ΧΧ•Χ Χ”ΧΧ’Χ™Χ©Χ•Χ:**  
- Χ•Χ§Χ Χ™Χ Χ”Χ“Χ΅ ΧΧ΅ΧΧ¨ β€“ 324966993  
- Χ™Χ©Χ¨ΧΧΧ™ ΧΧ”Χ™ΧΧ” β€“ 325119493  

**Χ©Χ Χ”ΧΧΆΧ¨Χ›Χ:**  
Χ Χ™Χ”Χ•Χ Χ›Χ΅Χ¤Χ™Χ Χ‘Χ™Χ§Χ‘  
**Χ”Χ™Χ—Χ™Χ“Χ” Χ”Χ Χ‘Χ—Χ¨Χ:**  
ΧΧ—ΧΧ§Χ Χ›Χ΅Χ¤Χ™Χ

---

## ΧΧ•Χ›Χ ΧΆΧ Χ™Χ™Χ Χ™Χ

1. [ΧΧ‘Χ•Χ](#ΧΧ‘Χ•Χ)
2. [ΧΧ¨Χ©Χ™Χ ERD](#ΧΧ¨Χ©Χ™Χ-erd)
3. [ΧΧ¨Χ©Χ™Χ DSD](#ΧΧ¨Χ©Χ™Χ-dsd)
4. [Χ”Χ—ΧΧΧ•Χ ΧΆΧ™Χ¦Χ•Χ‘](#Χ”Χ—ΧΧΧ•Χ-ΧΆΧ™Χ¦Χ•Χ‘)
5. [Χ©Χ™ΧΧ•Χ Χ”Χ›Χ Χ΅Χ Χ ΧΧ•Χ Χ™Χ](#Χ©Χ™ΧΧ•Χ-Χ”Χ›Χ Χ΅Χ-Χ ΧΧ•Χ Χ™Χ)
6. [Χ’Χ™Χ‘Χ•Χ™ Χ•Χ©Χ—Χ–Χ•Χ¨ Χ ΧΧ•Χ Χ™Χ](#Χ’Χ™Χ‘Χ•Χ™-Χ•Χ©Χ—Χ–Χ•Χ¨-Χ ΧΧ•Χ Χ™Χ)
7. [Χ©ΧΧ‘ Χ‘ β€“ Χ©ΧΧ™ΧΧΧ•Χ Χ•ΧΆΧ“Χ›Χ•Χ Χ™Χ](#Χ“Χ•Χ—-Χ¤Χ¨Χ•Χ™Χ§Χ--Χ©ΧΧ‘-Χ‘)
8. [Χ©ΧΧ‘ Χ’- ΧΧ™Χ ΧΧ’Χ¨Χ¦Χ™Χ” Χ•ΧΧ‘ΧΧ™Χ](#Χ“Χ•Χ—-Χ¤Χ¨Χ•Χ™Χ§Χ--Χ©ΧΧ‘-Χ’)
9. [Χ©ΧΧ‘ Χ“- ΧΧ›Χ Χ•Χ](#Χ“Χ•Χ—-Χ¤Χ¨Χ•Χ™Χ§Χ--Χ©ΧΧ‘-Χ“)
10. [Χ©ΧΧ‘ Χ”- ΧΧΧ©Χ§ Χ’Χ¨Χ¤Χ™](#Χ©ΧΧ‘-Χ”-β€“-ΧΧΆΧ¨Χ›Χ-ΧΧ Χ™Χ”Χ•Χ-ΧΆΧ•Χ‘Χ“Χ™Χ-Χ΅Χ™Χ•Χ¨Χ™Χ-Χ•ΧΧ©ΧΧ•ΧΧ™Χ)


---

## ΧΧ‘Χ•Χ

### ΧΧ™ΧΧ•Χ¨ Χ”Χ ΧΧ•Χ Χ™Χ Χ”Χ Χ©ΧΧ¨Χ™Χ Χ‘ΧΧΆΧ¨Χ›Χ:

1. **ΧΧ‘ΧΧ ΧΧ©ΧΧ•ΧΧ™Χ (payment)** β€“ ΧΧ–Χ”Χ”, Χ΅Χ›Χ•Χ, ΧΧΧ¨Χ™Χ, Χ΅Χ•Χ’ (Χ”Χ›Χ Χ΅Χ”/Χ”Χ•Χ¦ΧΧ”)
2. **ΧΧ‘ΧΧ ΧΆΧ•Χ‘Χ“Χ™Χ (employee)** β€“ ΧΧ–Χ”Χ”, Χ©Χ, ΧΧΧ¨Χ™Χ Χ”ΧΧ—ΧΧ”, Χ©Χ›Χ¨
3. **ΧΧ‘ΧΧ ΧΧ§Χ¦Χ™Χ‘Χ™Χ (budgets)** β€“ Χ©Χ Χ”, Χ΅Χ›Χ•Χ
4. **ΧΧ‘ΧΧ Χ”Χ©Χ§ΧΆΧ•Χ (investments)** β€“ ΧΧ–Χ”Χ” Χ”Χ©Χ§ΧΆΧ”, ΧΧ©Χ§Χ™ΧΆ, Χ΅Χ›Χ•Χ, ΧΧ©Χ•ΧΧ”
5. **ΧΧ‘ΧΧ Χ¨Χ›Χ™Χ©Χ•Χ (purchases)** β€“ ΧΧ™Χ“ΧΆ ΧΆΧ ΧΧ” Χ Χ¨Χ›Χ©, Χ›ΧΧ”, Χ•ΧΧ™ Χ¨Χ›Χ©
6. **ΧΧ‘ΧΧ ΧΧ™Χ΅Χ™Χ (taxes)** β€“ Χ΅Χ›Χ•Χ, ΧΧ—Χ•Χ–, Χ›ΧΧΧ™Χ ΧΧ©ΧΧ Χ™Χ
7. **ΧΧ‘ΧΧ ΧΧ©Χ›Χ•Χ¨Χ•Χ (salary)** β€“ Χ‘Χ¨Χ•ΧΧ•, Χ ΧΧ•, Χ”Χ¤Χ¨Χ©Χ™Χ ΧΧ•Χ ΧΧ΅

### Χ”Χ¤Χ•Χ Χ§Χ¦Χ™Χ•Χ ΧΧ™Χ•Χ Χ”ΧΆΧ™Χ§Χ¨Χ™Χ Χ‘ΧΧΆΧ¨Χ›Χ:

- Χ§Χ™Χ©Χ•Χ¨ ΧΧ©ΧΧ•Χ ΧΧ”Χ©Χ§ΧΆΧ•Χ / Χ¨Χ›Χ™Χ©Χ•Χ / ΧΧ©Χ›Χ•Χ¨Χ•Χ
- Χ—Χ™Χ©Χ•Χ‘ Χ©Χ›Χ¨ Χ ΧΧ• ΧΧΧ—Χ¨ Χ Χ™Χ›Χ•Χ™ ΧΧ΅
- Χ Χ™Χ”Χ•Χ ΧΧ§Χ¦Χ™Χ‘ ΧΧ•Χ Χ”Χ›Χ Χ΅Χ•Χ Χ•Χ”Χ•Χ¦ΧΧ•Χ Χ‘Χ¤Χ•ΧΆΧ
- ΧΧΆΧ§Χ‘ ΧΧ—Χ¨ Χ¨Χ›Χ™Χ©Χ•Χ ΧΧ¤Χ™ Χ¦Χ¨Χ›Χ, Χ›ΧΧ•Χ Χ•ΧΧ—Χ™Χ¨
- Χ—Χ™Χ©Χ•Χ‘ ΧΧ΅Χ™Χ ΧΧ¤Χ™ Χ—Χ•Χ§Χ™Χ ΧΧ•ΧΧΧΧ™Χ

---

## ΧΧ¨Χ©Χ™Χ ERD

![ERD](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/ERD.png?raw=true)

---

## ΧΧ¨Χ©Χ™Χ DSD

![DSD](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/DSD.png?raw=true)

---

## Χ”Χ—ΧΧΧ•Χ ΧΆΧ™Χ¦Χ•Χ‘

1. Χ¨Χ™Χ›Χ•Χ– Χ›Χ Χ΅Χ•Χ’Χ™ Χ”ΧΧ©ΧΧ•ΧΧ™Χ Χ‘ΧΧ‘ΧΧ” ΧΧ—Χ (`payment`) ΧΧ Χ™Χ”Χ•Χ ΧΧ—Χ™Χ“ Χ•Χ§Χ.
2. Χ§Χ™Χ©Χ•Χ¨ Χ™Χ©Χ™Χ¨ Χ‘Χ™Χ `payment` ΧΧ‘Χ™Χ Χ”Χ©Χ§ΧΆΧ•Χ, Χ¨Χ›Χ™Χ©Χ•Χ Χ•ΧΧ©Χ›Χ•Χ¨Χ•Χ β€“ ΧΧ©Χ ΧΧΆΧ§Χ‘ Χ‘Χ¨Χ•Χ¨ ΧΧ—Χ¨Χ™ ΧΧ§Χ•Χ¨ Χ”Χ”Χ•Χ¦ΧΧ”/Χ”Χ›Χ Χ΅Χ”.
3. Χ¤Χ™Χ¦Χ•Χ Χ¨Χ›Χ™Χ©Χ•Χ ΧΧ¨Χ›Χ™Χ©Χ•Χ Χ›ΧΧΧ™Χ•Χ Χ•Χ¨Χ›Χ™Χ‘Χ™ Χ¨Χ›Χ™Χ©Χ” β€“ ΧΧ¤Χ™Χ¨Χ•Χ ΧΧΧ Χ©Χ ΧΧ” Χ Χ§Χ Χ”.
4. Χ”Χ¤Χ¨Χ“Χ ΧΧ©Χ›Χ•Χ¨Χ•Χ β€“ ΧΧΧ¤Χ©Χ¨Χ ΧΧ—Χ©Χ‘ Χ©Χ›Χ¨ Χ ΧΧ• ΧΧ¤Χ™ Χ—Χ•Χ§Χ™ ΧΧ΅ ΧΧ©ΧΧ Χ™Χ.
5. Χ©Χ™ΧΧ•Χ© Χ‘ΧΧ‘ΧΧ ΧΧ§Χ¦Χ™Χ‘Χ™Χ β€“ ΧΧΧΆΧ§Χ‘ Χ©Χ ΧΧ™ Χ•ΧΧ”Χ©Χ•Χ•ΧΧ” ΧΧ•Χ Χ”Χ•Χ¦ΧΧ•Χ.
6. Χ©ΧΧ™Χ¨Χ ΧΧ—Χ•Χ–Χ™ ΧΧ΅ Χ‘ΧΧ‘ΧΧ” Χ Χ¤Χ¨Χ“Χ β€“ Χ›Χ Χ Χ™ΧΧ ΧΧΆΧ“Χ›Χ Χ—Χ•Χ§Χ™Χ Χ‘ΧΧ™ ΧΧ©Χ Χ•Χ ΧΧ ΧΧ‘Χ Χ” Χ”ΧΧ‘ΧΧΧ•Χ.

---

## Χ©Χ™ΧΧ•Χ Χ”Χ›Χ Χ΅Χ Χ ΧΧ•Χ Χ™Χ

### 1. Χ©Χ™ΧΧ•Χ© Χ‘ΦΎMockaroo

[mockarooFiles](https://github.com/estisellam/department-finance---winery/tree/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/mockarooFiles)

### 2. Χ©Χ™ΧΧ•Χ© Χ‘ΦΎGENERATEDATA

[generatedataFiles](https://github.com/estisellam/department-finance---winery/tree/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/generatedataFiles)

### 3. Χ΅Χ§Χ¨Χ™Χ¤Χ Χ‘ΦΎPython

[scripts folder](https://github.com/estisellam/department-finance---winery/tree/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/python_script)

---

## Χ’Χ™Χ‘Χ•Χ™ Χ•Χ©Χ—Χ–Χ•Χ¨ Χ ΧΧ•Χ Χ™Χ

![Backup](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/%D7%A6%D7%99%D7%9C%D7%95%D7%9D%20%D7%9E%D7%A1%D7%9A%202025-05-02%20%D7%91-9.34.22.png?raw=true)

**Χ§Χ•Χ‘Χ¥ Χ”Χ’Χ™Χ‘Χ•Χ™:** `gibuy.sql`  
**Χ§Χ•Χ‘Χ¥ Χ”Χ©Χ—Χ–Χ•Χ¨:** `insertTables.sql`  
Χ‘Χ•Χ¦ΧΆ Χ©Χ™ΧΧ•Χ© Χ‘ΦΎpgAdmin ΧΧ™Χ™Χ¦Χ•Χ Χ•Χ©Χ—Χ–Χ•Χ¨ Χ”Χ ΧΧ•Χ Χ™Χ.

---

# Χ“Χ•Χ— Χ¤Χ¨Χ•Χ™Χ§Χ β€“ Χ©ΧΧ‘ Χ‘
## π”Ή Χ©ΧΧ™ΧΧΧ•Χ select
### 1. Χ›Χ Χ”ΧΆΧ•Χ‘Χ“Χ™Χ Χ©ΧΧ—Χ¨ΧΧ™Χ ΧΆΧ Χ”Χ©Χ§ΧΆΧ•Χ, ΧΧΧ•Χ™Χ Χ™Χ ΧΧ¤Χ™ ΧΧ³-Χ‘Χ³
```sql
SELECT DISTINCT e.e_id, e.e_name
FROM employee e
NATURAL JOIN payment p
NATURAL JOIN in_Investments i
;ORDER BY e.e_name ASC
```
![](DBProject/Χ©ΧΧ‘%20Χ‘/Χ¦Χ™ΧΧ•Χ%20ΧΧ΅Χ%202025-05-11%20Χ‘-11.24.02select4select1.png)
![](DBProject/Χ©ΧΧ‘%20Χ‘/Χ¦Χ™ΧΧ•Χ%20ΧΧ΅Χ%202025-05-11%20Χ‘-11.24.16select4select1.png)
![](DBProject/Χ©ΧΧ‘%20Χ‘/Χ¦Χ™ΧΧ•Χ%20ΧΧ΅Χ%202025-05-11%20Χ‘-11.24.19select4select1.png)
---

### 2. Χ›Χ Χ”Χ¨Χ›Χ™Χ©Χ•Χ Χ©Χ”ΧΧ‘Χ¦ΧΆΧ• Χ‘ΧΧΧ¨Χ™Χ 2024-06-19
```sql
SELECT p.p_id, p.p_date, i.id_Consumer
FROM payment p
NATURAL JOIN in_Purchases_from i
WHERE p.p_date = '2024-06-19';
```
![](DBProject/Χ©ΧΧ‘%20Χ‘/Χ¦Χ™ΧΧ•Χ%20ΧΧ΅Χ%202025-05-11%20Χ‘-11.30.40select2.png)
![](DBProject/Χ©ΧΧ‘%20Χ‘/Χ¦Χ™ΧΧ•Χ%20ΧΧ΅Χ%202025-05-11%20Χ‘-11.30.44select2.png)
---
### 3. Χ›Χ Χ”ΧΆΧ•Χ‘Χ“Χ™Χ Χ©Χ”ΧΧ—Χ™ΧΧ• ΧΧΆΧ‘Χ•Χ“ ΧΧ¤Χ Χ™ 2020
```sql
SELECT e_id, e_name, job_start_date
FROM employee
WHERE job_start_date < '2020-01-01'
ORDER BY job_start_date ASC;
```
![](DBProject/Χ©ΧΧ‘%20Χ‘/Χ¦Χ™ΧΧ•Χ%20ΧΧ΅Χ%202025-05-11%20Χ‘-11.37.15select3.png)
![](DBProject/Χ©ΧΧ‘%20Χ‘/Χ¦Χ™ΧΧ•Χ%20ΧΧ΅Χ%202025-05-11%20Χ‘-11.37.18select3.png)
---

### 4. Χ΅Χ Χ›Χ Χ”Χ΅Χ›Χ•Χ Χ©Χ ΧΧ©ΧΧ•ΧΧ™Χ Χ Χ›Χ Χ΅Χ™Χ Χ‘Χ›Χ Χ©Χ Χ”
```sql
SELECT p_year, SUM(p_sum) AS total_income
FROM payment
WHERE in_or_out = 'in'
GROUP BY p_year
ORDER BY p_year;
```
![](DBProject/Χ©ΧΧ‘%20Χ‘/Χ¦Χ™ΧΧ•Χ%20ΧΧ΅Χ%202025-05-11%20Χ‘-11.38.02select4.png)
![](DBProject/Χ©ΧΧ‘%20Χ‘/Χ¦Χ™ΧΧ•Χ%20ΧΧ΅Χ%202025-05-11%20Χ‘-11.38.06select4.png)
### 5. ΧΆΧ•Χ‘Χ“Χ™Χ ΧΆΧ Χ©Χ›Χ¨ Χ’Χ‘Χ•Χ” Χ•ΧΧ—Χ¨Χ™Χ•Χ ΧΦΎ3+ ΧΧ©ΧΧ•ΧΧ™Χ
```sql
SELECT e.e_id, e.e_name, e.salary
FROM employee e
NATURAL JOIN payment p
GROUP BY e.e_id, e.e_name, e.salary
HAVING e.salary > 10000 AND COUNT(p.p_id) > 3;
```
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select05-before.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select05-run.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select05-result.png)

---

### 6. Χ›Χ Χ”Χ”Χ›Χ Χ΅Χ•Χ ΧΧ©Χ Χ 2023
```sql
SELECT p.*
FROM payment p 
JOIN budgets b ON p.p_year = b.b_year 
WHERE p.p_year = 2023 AND p.in_or_out = 'in';
```
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select06-before.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select06-run.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select06-result.png)

---

### 7. ΧΆΧ•Χ‘Χ“Χ™Χ ΧΆΧ Χ”Χ¤Χ¨Χ© Χ©Χ›Χ¨ Χ ΧΧ• β‰¤ 2000
```sql
SELECT e.e_id, e.e_name, e.salary, s.neto_salary
FROM employee e
NATURAL JOIN salary s
WHERE (e.salary - s.neto_salary) <= 2000;
```
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select07-before.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select07-run.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select07-result.png)

---

### 8. Χ¦Χ¨Χ›Χ Χ™Χ ΧΆΧ Χ¤Χ—Χ•Χ ΧΦΎ2 Χ¨Χ›Χ™Χ©Χ•Χ Χ‘ΦΎ2023
```sql
SELECT i.id_Consumer, COUNT(*) AS total_purchases
FROM in_Purchases_from i
NATURAL JOIN payment p
WHERE EXTRACT(YEAR FROM p.p_date) = 2023
GROUP BY i.id_Consumer
HAVING COUNT(*) < 2;
```
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select08-before.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select08-run.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select08-result.png)

---

## π”Ή Χ©ΧΧ™ΧΧΧ•Χ UPDATE

### 1. ΧΆΧ“Χ›Χ•Χ ΧΧ—Χ•Χ– Χ¨Χ•Χ•Χ— ΧΧΧ©Χ§Χ™ΧΆΧ™Χ ΧΆΧ ΧΧ©ΧΧ•Χ ΧΧΆΧ 10,000
```sql
UPDATE Investments
SET profit_Percentage = 15
WHERE id_Investor IN (
  SELECT ii.id_Investor
  FROM in_Investments ii
  NATURAL JOIN payment p
  WHERE p.p_sum > 10000
);
```
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/update01-before.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/update01-run.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/update01-after.png)

---

### 2. Χ”ΧΆΧΧΧ Χ©Χ›Χ¨ Χ‘ΦΎ10% ΧΧΆΧ•Χ‘Χ“Χ™Χ ΧΆΧ 3+ ΧΧΧ•Χ©Χ™ Χ©Χ›Χ¨
```sql
UPDATE employee
SET salary = salary * 1.10
WHERE e_id IN (
  SELECT e_id
  FROM salary
  GROUP BY e_id
  HAVING COUNT(*) >= 3
);
```
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/update02-before.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/update02-run.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/update02-after.png)

---

### 3. Χ”Χ•Χ¨Χ“Χ ΧΧ—Χ•Χ– ΧΧ΅ ΧΦΎ8% ΧΆΧ‘Χ•Χ¨ ΧΧ©ΧΧ•ΧΧ™Χ ΧΦΎ2022
```sql
UPDATE taxes
SET percent = 8
WHERE t_id IN (
  SELECT ot.t_id
  FROM out_taxes ot
  NATURAL JOIN payment p
  WHERE p.p_year = 2022
);
```
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/update03-before.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/update03-run.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/update03-after.png)

---

## π”Ή Χ©Χ™ΧΧ•Χ© Χ‘ΦΎROLLBACK
```sql
BEGIN;
UPDATE employee
SET salary = salary + 123
WHERE e_id = 200;
ROLLBACK;
```
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/rollback-before.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/rollback-run.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/rollback-result.png)

---
## π”Ή Χ©Χ™ΧΧ•Χ© Χ‘ΦΎCOMMIT

```sql
BEGIN;
UPDATE employee
SET salary = salary + 123
WHERE e_id = 200;
COMMIT;
```

![ΧΧ¤Χ Χ™](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/commit-before.png?raw=true)  
![Χ”Χ¨Χ¦Χ”](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/commit-run.png?raw=true)  
![ΧΧ•Χ¦ΧΧ”](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/commit-result.png?raw=true)

---


## Χ©ΧΧ™ΧΧΧ•Χ DELETE
### 1. ΧΧ—Χ™Χ§Χ Χ¨Χ›Χ™Χ©Χ•Χ ΧΧ”Χ™Χ§Χ‘ Χ©Χ‘Χ•Χ¦ΧΆΧ• ΧΧ¤Χ Χ™ Χ©Χ Χ 2023
```sql
BEGIN;
DELETE FROM out_Purchase_for_the_winery
WHERE p_id IN (
  SELECT pfw.p_id
  FROM out_Purchase_for_the_winery pfw
  NATURAL JOIN payment p
  WHERE p.p_date < '2023-01-01'
);
ROLLBACK;
```
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/delete%201.png)


### 2. ΧΧ—Χ™Χ§Χ Χ›Χ Χ”Χ¦Χ¨Χ›Χ Χ™Χ Χ©Χ‘Χ™Χ¦ΧΆΧ• Χ¤Χ—Χ•Χ ΧΦΎ2 Χ¨Χ›Χ™Χ©Χ•Χ

```sql
BEGIN;
DELETE FROM Purchase_from_the_winery
WHERE id_Consumer IN (
  SELECT id_Consumer
  FROM in_Purchases_from
  GROUP BY id_Consumer
  HAVING COUNT(*) < 2
);
ROLLBACK;
```
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/delete%202.png)

### 3. ΧΧ—Χ™Χ§Χ Χ¦Χ¨Χ›Χ Χ™Χ Χ©ΧΧ Χ‘Χ™Χ¦ΧΆΧ• ΧΧ£ Χ¨Χ›Χ™Χ©Χ” Χ‘Χ©Χ Χ 2024
```sql
BEGIN;
DELETE FROM Purchase_from_the_winery
WHERE id_Consumer IN (
  SELECT DISTINCT pf.id_Consumer
  FROM in_Purchases_from pf
  WHERE pf.id_Consumer NOT IN (
    SELECT pf2.id_Consumer
    FROM in_Purchases_from pf2
    NATURAL JOIN payment p
    WHERE EXTRACT(YEAR FROM p.p_date) = 2024
  )
);
ROLLBACK;
```
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/delete%203.png)
## π”Ή ΧΧ™ΧΧ•Χ¦Χ™Χ
### 1. ΧΧ™ΧΧ•Χ¥ NOT NULL ΧΆΧ ΧΧΧ¨Χ™Χ Χ‘ΧΧ©ΧΧ•ΧΧ™Χ
```sql
ALTER TABLE payment
ALTER COLUMN p_date SET NOT NULL;

-- Χ Χ™Χ΅Χ™Χ•Χ Χ”Χ¤Χ¨Χ”
INSERT INTO payment (p_id, p_date, p_sum, in_or_out)
VALUES (501, NULL, 5000, 'in');
```
---
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/Constraints1.png)
### 2. ΧΧ™ΧΧ•Χ¥ ΧΆΧ Χ©Χ›Χ¨- Χ©Χ™Χ”Χ™Χ” Χ¨Χ§ Χ—Χ™Χ•Χ‘
```sql
-- Χ”Χ•Χ΅Χ¤Χ Χ”ΧΧ™ΧΧ•Χ¥
ALTER TABLE employee
ADD CONSTRAINT check_positive_salary
CHECK (salary > 0);

-- Χ Χ™Χ΅Χ™Χ•Χ ΧΧ”Χ¤Χ¨Χ Χ”ΧΧ™ΧΧ•Χ¥
INSERT INTO employee (e_id, e_name, start_date, salary)
VALUES (300, 'Χ“Χ•Χ’ΧΧ”', '2025-01-01', -1000);

```
---
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/Constraints%202.png)
### 3. ΧΧ™ΧΧ•Χ¥ ΧΆΧ ΧΧ™Χ΅Χ™Χ- ΧΆΧ¨Χ Χ‘Χ¨Χ™Χ¨Χ Χ”ΧΧ—Χ“Χ Χ©Χ Χ©Χ™ΧΆΧ•Χ¨ Χ”ΧΧ΅- 17%

```sql
-- Χ”Χ•Χ΅Χ¤Χ Χ”ΧΧ™ΧΧ•Χ¥
ALTER TABLE taxes
ALTER COLUMN percent SET DEFAULT 17;

-- Χ”Χ›Χ Χ΅Χ Χ¨Χ©Χ•ΧΧ” ΧΧΧ Χ¦Χ™Χ•Χ ΧΧ—Χ•Χ– Χ”ΧΧ΅
INSERT INTO taxes (t_id, taxname, principal_amount)
VALUES (999, 'ΧΧ΅ Χ Χ™Χ΅Χ™Χ•Χ', 10000);

-- Χ‘Χ“Χ™Χ§Χ Χ”ΧΆΧ¨Χ Χ©Χ Χ§Χ‘ΧΆ
SELECT * FROM taxes WHERE t_id = 999;

```

---
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/Constraints%203.png)

# Χ“Χ•Χ— Χ¤Χ¨Χ•Χ™Χ§Χ β€“ Χ©ΧΧ‘ Χ’
## ΧΧ’Χ£ ΧΧ¨Χ›Χ– ΧΧ‘Χ§Χ¨Χ™Χ- ERD
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%92/ERD_MERCAZ_MEVAKRIM.png?raw=true)

## ΧΧ’Χ£ ΧΧ¨Χ›Χ– ΧΧ‘Χ§Χ¨Χ™Χ- DSD
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%92/DSD%20mercaz%20mevacrim.jpeg?raw=true)

## ΧΧ™Χ ΧΧ’Χ¨Χ¦Χ™Χ” -ERD
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%92/ERD%20Integration.png?raw=true)

## ΧΧ™Χ ΧΧ’Χ¨Χ¦Χ™Χ”- DSD
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%92/DSD%20INTEGRETION.png?raw=true)


## Χ”Χ—ΧΧΧ•Χ Χ©Χ ΧΆΧ©Χ• Χ‘Χ©ΧΧ‘ Χ”ΧΧ™Χ ΧΧ’Χ¨Χ¦Χ™Χ”

### ΧΆΧ§Χ¨Χ•Χ Χ•Χ Χ©Χ”Χ Χ—Χ• ΧΧ•ΧΧ Χ•:
- ΧΧΧ—Χ“ ΧΧ‘ΧΧΧ•Χ Χ‘ΧΆΧΧ•Χ ΧΧ¤Χ§Χ™Χ“ Χ“Χ•ΧΧ” (Χ›Χ’Χ•Χ payment).
- ΧΧ©ΧΧ•Χ¨ ΧΆΧ§Χ‘Χ™Χ•Χ Χ‘Χ©ΧΧ•Χ ΧΆΧΧ•Χ“Χ•Χ Χ•ΧΧ¤ΧΧ—Χ•Χ.
- ΧΧ™Χ™ΧΆΧ ΧΧ Χ”Χ΅Χ›Χ™ΧΧ” Χ›Χ“Χ™ ΧΧΧ Χ•ΧΆ Χ›Χ¤Χ™ΧΧ•Χ™Χ•Χ Χ•ΧΧ”Χ§Χ ΧΆΧ Χ©ΧΧ™Χ¤Χ•Χ.

### ΧΧ‘ΧΧΧ•Χ Χ©ΧΧ•Χ—Χ“Χ•:

#### 1. payment + payment:
Χ©ΧΧ™ Χ”ΧΧ‘ΧΧΧ•Χ Χ™Χ™Χ¦Χ’Χ• ΧΧ©ΧΧ•ΧΧ™Χ ΧΧ΅Χ•Χ’Χ™Χ Χ©Χ•Χ Χ™Χ β€“ Χ©Χ›Χ¨ ΧΆΧ•Χ‘Χ“Χ™Χ, Χ¨Χ›Χ™Χ©Χ•Χ, Χ”Χ›Χ Χ΅Χ•Χ ΧΧΧ™Χ™Χ¨Χ™Χ Χ•ΧΆΧ•Χ“.
Χ”Χ ΧΧ•Χ—Χ“Χ• ΧΧΧ‘ΧΧ” ΧΧ—Χ Χ‘Χ©Χ payment.
Χ Χ•Χ΅Χ¤Χ” ΧΆΧΧ•Χ“Χ” Χ—Χ“Χ©Χ”: payment_type ΧΧ©Χ¨ ΧΧΧΧ¨Χ ΧΧ ΧΧ§Χ•Χ¨ ΧΧ• Χ΅Χ•Χ’ Χ”ΧΧ©ΧΧ•Χ (ΧΧ“Χ•Χ’ΧΧ”: salary, tour_income, purchase, investment Χ•Χ›Χ•').

#### 2. employee + guide:
ΧΧ“Χ¨Χ™Χ›Χ™Χ Χ”Χ ΧΧ-Χ§Χ‘Χ•Χ¦Χ” Χ©Χ ΧΆΧ•Χ‘Χ“Χ™Χ Χ•ΧΧ›Χ ΧΧ™Χ—Χ“Χ Χ• ΧΧ Χ©ΧΧ™ Χ”ΧΧ‘ΧΧΧ•Χ ΧΧΧ‘ΧΧ” ΧΧ—Χ Χ‘Χ©Χ employee.
Χ‘ΧΧ‘ΧΧ” Χ”Χ—Χ“Χ©Χ” Χ Χ•Χ΅Χ¤Χ” ΧΆΧΧ•Χ“Χ” role, ΧΆΧ ΧΆΧ¨Χ›Χ™Χ Χ›Χ’Χ•Χ guide, admin, worker Χ•Χ›Χ•'.
Χ©Χ“Χ•Χ Χ™Χ™Χ—Χ•Χ“Χ™Χ™Χ ΧΧΧ“Χ¨Χ™Χ›Χ™Χ Χ›ΧΧ•:
- languages β€“ Χ©Χ¤Χ•Χ Χ©Χ”ΧΧ“Χ¨Χ™Χ Χ“Χ•Χ‘Χ¨.
- guided β€“ ΧΧ΅Χ¤Χ¨ Χ΅Χ™Χ•Χ¨Χ™Χ Χ©Χ”Χ“Χ¨Χ™Χ.

Χ”Χ•Χ›Χ Χ΅Χ• ΧΧΧ‘ΧΧ” ΧΆΧ ΧΆΧ¨Χ›Χ™Χ Χ¨ΧΧ•Χ•Χ ΧΧ™Χ™Χ ΧΧΧ“Χ¨Χ™Χ›Χ™Χ, Χ•ΧΆΧ¨Χ›Χ™ Χ‘Χ¨Χ™Χ¨Χ ΧΧ—Χ“Χ (ΧΆΧ‘Χ¨Χ™Χ) ΧΧ©ΧΧ¨ Χ”ΧΆΧ•Χ‘Χ“Χ™Χ.


## Χ”Χ΅Χ‘Χ¨ ΧΧ™ΧΧ•ΧΧ™ Χ©Χ Χ”ΧΧ”ΧΧ™Χ Χ•Χ”Χ¤Χ§Χ•Χ“Χ•Χ

### Χ©Χ™Χ Χ•Χ™Χ™Χ Χ‘ΧΧ‘ΧΧ employee
```sql
ALTER TABLE employee ADD COLUMN employee_role TEXT;           -- ΧΧΧ©Χ 'guide', 'worker'
ALTER TABLE employee ADD COLUMN languages TEXT;      -- Χ¨Χ§ ΧΧΧ“Χ¨Χ™Χ›Χ™Χ
ALTER TABLE employee ADD COLUMN guided INTEGER;      -- Χ¨Χ§ ΧΧΧ“Χ¨Χ™Χ›Χ™Χ
```
#### Χ”Χ•Χ΅Χ¤Χ Χ©Χ“Χ•Χ:
- `employee_role` (`TEXT`)  
  ΧΧ©ΧΧ© ΧΧ¦Χ™Χ•Χ ΧΧ¤Χ§Χ™Χ“ Χ”ΧΆΧ•Χ‘Χ“ (ΧΧΧ©Χ: `"guide"`, `"worker"`).

- `languages` (`TEXT`)  
  ΧΧ¦Χ™Χ™Χ ΧΧ™ΧΧ• Χ©Χ¤Χ•Χ ΧΧ“Χ¨Χ™Χ ΧΧ“Χ‘Χ¨. Χ¨ΧΧ•Χ•Χ ΧΧ™ Χ¨Χ§ ΧΧΆΧ•Χ‘Χ“Χ™Χ Χ‘ΧΧ¤Χ§Χ™Χ“ ΧΧ“Χ¨Χ™Χ.

- `guided` (`INTEGER`)  
  Χ©Χ“Χ” ΧΧ΅Χ¤Χ¨Χ™ ΧΧ¦Χ™Χ•Χ Χ›ΧΧ” Χ”Χ“Χ¨Χ›Χ•Χ Χ”ΧΆΧ•Χ‘Χ“ Χ‘Χ™Χ¦ΧΆ.

---

### Χ©Χ™Χ Χ•Χ™Χ™Χ Χ‘ΧΧ‘ΧΧ Χ”ΧΧ©ΧΧ•ΧΧ™Χ (`payment`)

```sql
ALTER TABLE payment ADD COLUMN payment_type TEXT;      -- ΧΧ§Χ•Χ¨ Χ”ΧΧ©ΧΧ•Χ:
```
#### Χ”Χ•Χ΅Χ¤Χ Χ©Χ“Χ•Χ:
- `payment_type` (`TEXT`)  
  ΧΧ¦Χ™Χ™Χ ΧΧ ΧΧ§Χ•Χ¨ Χ”ΧΧ©ΧΧ•Χ, ΧΧ“Χ•Χ’ΧΧ”: Credit, Bank Transfer, Bit .


#### Χ”Χ•Χ΅Χ¤Χ Χ§Χ©Χ¨Χ™Χ (Foreign Keys):
```sql
ALTER TABLE payment
ADD CONSTRAINT fk_payment_employee
FOREIGN KEY (e_id) REFERENCES employee(e_id);
```

- `e_id` β†’ `employee(e_id)`  
  Χ§Χ™Χ©Χ•Χ¨ Χ©Χ ΧΧ©ΧΧ•Χ ΧΧΆΧ•Χ‘Χ“ (ΧΧΧ©Χ Χ›ΧΧ©Χ¨ ΧΆΧ•Χ‘Χ“ Χ©Χ™ΧΧ ΧΆΧ Χ©Χ™Χ¨Χ•Χ ΧΧ΅Χ•Χ™Χ).

- `visitorid` β†’ `visitor(visitorid)`  
  Χ§Χ™Χ©Χ•Χ¨ Χ©Χ ΧΧ©ΧΧ•Χ ΧΧΧ‘Χ§Χ¨.

---

### Χ©Χ™Χ Χ•Χ™Χ™Χ Χ‘ΧΧ‘ΧΧ Χ”Χ΅Χ™Χ•Χ¨Χ™Χ (`tour`)
```sql
ALTER TABLE tour
ADD CONSTRAINT fk_tour_guide
FOREIGN KEY (guide_id) REFERENCES employee(e_id);
```
#### Χ”Χ•Χ΅Χ¤Χ Χ§Χ©Χ¨:
- `guide_id` β†’ `employee(e_id)`  
  Χ›Χ ΧΧ“Χ¨Χ™Χ Χ΅Χ™Χ•Χ¨ Χ—Χ™Χ™Χ‘ ΧΧ”Χ™Χ•Χ ΧΆΧ•Χ‘Χ“ Χ§Χ™Χ™Χ Χ‘ΧΧ‘ΧΧ `employee`.


#### Χ”Χ›Χ Χ΅Χ Χ ΧΧ•Χ Χ™Χ ΧΧΧ‘ΧΧΧ•Χ:
```sql
UPDATE employee e
SET 
    employee_role = 'guide',
    languages = g.languages,
    guided = g.guided
FROM guide g
WHERE e.e_id = g.guide_id;
```
##### Χ”Χ΅Χ‘Χ¨:
ΧΧ—Χ¨Χ™ Χ©Χ™Χ¦Χ¨Χ Χ• ΧΧ Χ”ΧΆΧΧ•Χ“Χ•Χ Χ”Χ—Χ“Χ©Χ•Χ, ΧΧ©Χ›Χ Χ• ΧΆΧ¨Χ›Χ™Χ ΧΧΧ‘ΧΧ guide ΧΧ¤Χ™ Χ”Χ”ΧΧΧΧ” Χ©Χ Χ”id Χ©Χ Χ”ΧΆΧ•Χ‘Χ“Χ™Χ
```sql
INSERT INTO payments_table (p_id, p_date, in_or_out, p_sum, p_year, e_id, payment_type)
SELECT
    p1.paymentid,
    p1.paymentdate,
    'in',
    p1.amount,
    EXTRACT(YEAR FROM p1.paymentdate),
    NULL,
    payment method 
FROM payment1 p1;
```
##### Χ”Χ΅Χ‘Χ¨:
Χ”ΧΧ¨Χ Χ• Χ ΧΧ•Χ Χ™Χ ΧΧ”ΧΧ‘ΧΧ” payment ΧΧΧ‘Χ Χ” Χ”ΧΧ‘ΧΧ” Χ”Χ—Χ“Χ©Χ” ΧΧ•Χ Χ—Χ™Χ©Χ•Χ‘ Χ•Χ”ΧΧΧΧ Χ©Χ“Χ•Χ Χ›ΧΧ• ΧΧΧ¨Χ™Χ, Χ©Χ Χ” Χ•Χ΅Χ•Χ’ ΧΧ©ΧΧ•Χ. Χ§Χ¨ΧΧ Χ• ΧΧΧ‘ΧΧ” payment Χ©Χ Χ”Χ‘Χ΅Χ™Χ΅ Χ ΧΧ•Χ Χ™Χ Χ©Χ Χ”ΧΧ¨Χ›Χ– ΧΧ‘Χ§Χ¨Χ™Χ payment1 Χ›Χ“Χ™ Χ©ΧΧ Χ™Χ”Χ™Χ• ΧΧ Χ• Χ›Χ¤Χ™ΧΧ•Χ™Χ•Χ Χ©Χ ΧΧ‘ΧΧΧ•Χ Χ‘Χ‘Χ΅Χ™Χ΅ Χ ΧΧ•Χ Χ™Χ Χ”ΧΧ©Χ•ΧΧ£ ΧΧ¤Χ Χ™ Χ”Χ©Χ™Χ Χ•Χ™Χ™Χ.

#### Χ”Χ›Χ Χ΅Χ ΧΆΧ¨Χ›Χ™ Χ‘Χ¨Χ™Χ¨Χ ΧΧ—Χ“Χ:
```sql
ALTER TABLE employee
ALTER COLUMN guide SET DEFAULT 'worker';
```
Χ›Χ ΧΆΧ•Χ‘Χ“ Χ©Χ”Χ•Χ ΧΧ ΧΧ“Χ¨Χ™Χ- Χ”Χ•Χ ΧΆΧ•Χ‘Χ“ Χ¤Χ©Χ•Χ
```sql
ALTER TABLE employee
ALTER COLUMN languege SET DEFAULT 'ΧΆΧ‘Χ¨Χ™Χ';
```
Χ›Χ ΧΆΧ•Χ‘Χ“ Χ©ΧΧ ΧΧ“Χ¨Χ™Χ- Χ“Χ•Χ‘Χ¨ Χ¨Χ§ Χ©Χ¤Χ” ΧΆΧ‘Χ¨Χ™Χ ΧΧΧ ΧΧ Χ”Χ•Χ’Χ“Χ¨ ΧΧ—Χ¨Χ
```sql
ALTER TABLE employee
ALTER COLUMN guided SET DEFAULT 0;
```
Χ›Χ ΧΆΧ•Χ‘Χ“ Χ©ΧΧ ΧΧ“Χ¨Χ™Χ- ΧΧ Χ”Χ“Χ¨Χ™Χ£ ΧΧ£ Χ¤ΧΆΧ Χ•ΧΧ›Χ Χ”Χ“Χ¨Χ™Χ 0 Χ΅Χ™Χ•Χ¨Χ™Χ
```sql
ALTER TABLE payment
ALTER COLUMN payment_type SET DEFAULT 'credit';
```
Χ©Χ™ΧΧ Χ”ΧΧ©ΧΧ•Χ Χ”Χ¨Χ’Χ™ΧΧ” Χ”Χ™Χ•Χ Χ”Χ™Χ Χ“Χ¨Χ Χ›Χ¨ΧΧ™Χ΅ ΧΧ©Χ¨ΧΧ™ Χ•ΧΧ›Χ Χ–Χ” Χ”Χ‘Χ¨Χ™Χ¨Χ ΧΧ—Χ“Χ

---
---

### Χ΅Χ™Χ›Χ•Χ

Χ©Χ™Χ Χ•Χ™Χ™Χ ΧΧΧ• ΧΧΧ¤Χ©Χ¨Χ™Χ:
- Χ”Χ‘Χ“ΧΧ” Χ‘Χ™Χ Χ΅Χ•Χ’Χ™ ΧΆΧ•Χ‘Χ“Χ™Χ.
- ΧΧΆΧ§Χ‘ ΧΧ—Χ¨ Χ©Χ¤Χ•Χ Χ”Χ“Χ¨Χ›Χ” Χ•Χ Χ™Χ΅Χ™Χ•Χ Χ”Χ“Χ¨Χ›ΧΧ™.
- Χ©Χ™Χ•Χ ΧΧ©ΧΧ•ΧΧ™Χ ΧΧ΅Χ•Χ’.
- Χ”Χ’Χ“Χ¨Χ Χ§Χ©Χ¨Χ™Χ Χ‘Χ™Χ Χ΅Χ™Χ•Χ¨Χ™Χ, ΧΧ“Χ¨Χ™Χ›Χ™Χ, ΧΧ©ΧΧ•ΧΧ™Χ Χ•ΧΧ‘Χ§Χ¨Χ™Χ.


## ΦΏ ΧΧ‘Χ 1 β€“ `view_tours_with_guide_info`

###  ΧΧ™ΧΧ•Χ¨ ΧΧ™ΧΧ•ΧΧ™:
ΧΧ‘Χ Χ–Χ” ΧΧΧ—Χ“ ΧΧ™Χ“ΧΆ ΧΧΧ‘ΧΧ Χ”Χ΅Χ™Χ•Χ¨Χ™Χ (tour) ΧΆΧ ΧΧ™Χ“ΧΆ ΧΆΧ ΧΧ“Χ¨Χ™Χ›Χ™Χ ΧΧΧ‘ΧΧ Χ”ΧΆΧ•Χ‘Χ“Χ™Χ (employee), Χ•Χ›Χ•ΧΧ Χ¨Χ§ ΧΆΧ•Χ‘Χ“Χ™Χ Χ‘ΧΆΧΧ™ ΧΧ¤Χ§Χ™Χ“ `guide`.
Χ”ΧΧ‘Χ ΧΧ¦Χ™Χ’: ΧΧ–Χ”Χ” Χ΅Χ™Χ•Χ¨, ΧΧ—Χ™Χ¨, ΧΧ™ΧΧ•Χ¨, Χ›ΧΧ•Χ ΧΧ©ΧΧΧ¤Χ™Χ, Χ©Χ Χ”ΧΧ“Χ¨Χ™Χ, Χ©Χ¤Χ•Χ Χ©Χ”Χ•Χ Χ“Χ•Χ‘Χ¨, Χ•Χ›ΧΧ•Χ Χ΅Χ™Χ•Χ¨Χ™Χ Χ©Χ”ΧΆΧ‘Χ™Χ¨.

```sql
CREATE VIEW view_tours_with_guide_info AS
SELECT 
    t.tourid,
    t.price,
    t.description,
    t.amount,
    e.e_name AS guide_name,
    e.languages,
    e.guided_tours
FROM 
    tour t
JOIN 
    employee e ON t.guideid = e.e_id
WHERE 
    e.employee_role = 'guide';

```


---

###  Χ©ΧΧ™ΧΧΧ” 1:
#### ΧΧ™ΧΧ•Χ¨:
ΧΧ¦Χ™Χ’Χ” ΧΧ Χ΅Χ Χ”Χ”Χ›Χ Χ΅Χ•Χ ΧΧ›Χ Χ΅Χ™Χ•Χ¨ (ΧΧ—Χ™Χ¨ * Χ›ΧΧ•Χ ΧΧ©ΧΧΧ¤Χ™Χ) ΧΆΧ‘Χ•Χ¨ Χ›Χ ΧΧ“Χ¨Χ™Χ.
```sql
SELECT 
    guide_name,
    SUM(price * amount) AS total_income
FROM 
    view_tours_with_guide_info
GROUP BY 
    guide_name;
```

![](DBProject/Χ©ΧΧ‘%20Χ’/m1.1.png)
---

###  Χ©ΧΧ™ΧΧΧ” 2:
#### ΧΧ™ΧΧ•Χ¨:
ΧΧ¦Χ™Χ’Χ” ΧΧ Χ›Χ Χ”Χ΅Χ™Χ•Χ¨Χ™Χ Χ©ΧΧ—Χ™Χ¨Χ Χ’Χ‘Χ•Χ” ΧΧ”ΧΧΧ•Χ¦ΧΆ Χ‘Χ›ΧΧ Χ”Χ΅Χ™Χ•Χ¨Χ™Χ.
```sql
SELECT * 
FROM view_tours_with_guide_info
WHERE price > (
    SELECT AVG(price) 
    FROM view_tours_with_guide_info
);
```

![](DBProject/Χ©ΧΧ‘%20Χ’/m1.2.png)

---

##  ΧΧ‘Χ 2 β€“ `view_employee_payments`

###  ΧΧ™ΧΧ•Χ¨ ΧΧ™ΧΧ•ΧΧ™:
ΧΧ‘Χ Χ–Χ” ΧΧΧ—Χ“ Χ‘Χ™Χ ΧΧ‘ΧΧ Χ”ΧΧ©ΧΧ•ΧΧ™Χ (payment) Χ•ΧΧ‘ΧΧ Χ”ΧΆΧ•Χ‘Χ“Χ™Χ (employee), Χ•ΧΧ¦Χ™Χ’ ΧΧ™Χ“ΧΆ ΧΧΧ ΧΆΧ Χ›Χ ΧΧ©ΧΧ•Χ Χ©Χ‘Χ•Χ¦ΧΆ ΧΧΆΧ•Χ‘Χ“:
ΧΧ–Χ”Χ” ΧΧ©ΧΧ•Χ, ΧΧΧ¨Χ™Χ, Χ΅Χ›Χ•Χ, Χ΅Χ•Χ’ ΧΧ©ΧΧ•Χ, Χ”ΧΧ ΧΧ“Χ•Χ‘Χ¨ Χ‘Χ”Χ›Χ Χ΅Χ” ΧΧ• Χ”Χ•Χ¦ΧΧ”, Χ©Χ Χ”ΧΆΧ•Χ‘Χ“ Χ•ΧΧ¤Χ§Χ™Χ“Χ•.

```sql
CREATE VIEW view_employee_payments AS
SELECT 
    p.p_id,
    p.p_date,
    p.p_sum,
    p.payment_type,
    p.in_or_out,
    e.e_name AS employee_name,
    e.employee_role
FROM 
    payment p
JOIN 
    employee e ON p.e_id = e.e_id;

```


---

###  Χ©ΧΧ™ΧΧΧ” 1:
#### ΧΧ™ΧΧ•Χ¨:
ΧΧΧ¦Χ•Χ ΧΧ Χ΅Χ›Χ•Χ Χ”ΧΧ©ΧΧ•ΧΧ™Χ Χ”Χ›Χ•ΧΧ Χ©Χ‘Χ™Χ¦ΧΆ Χ›Χ ΧΆΧ•Χ‘Χ“ Χ‘ΧΧ¤Χ§Χ™Χ“ ΧΧ΅Χ•Χ™Χ, ΧΧ¤Χ™ Χ΅Χ•Χ’ ΧΧ©ΧΧ•Χ (Χ”Χ›Χ Χ΅Χ”/Χ”Χ•Χ¦ΧΧ”), Χ•ΧΧΧ™Χ™Χ ΧΧ¤Χ™ Χ”Χ΅Χ›Χ•Χ Χ”Χ’Χ‘Χ•Χ” Χ‘Χ™Χ•ΧΧ¨..
```sql
SELECT 
    employee_name,
    employee_role,
    in_or_out,
    SUM(p_sum) AS total_payment
FROM 
    view_employee_payments
GROUP BY 
    employee_name, employee_role, in_or_out
HAVING 
    SUM(p_sum) > 10000
ORDER BY 
    total_payment DESC;

```

![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%92/m2.1.png)

---

###  Χ©ΧΧ™ΧΧΧ” 2:
#### ΧΧ™ΧΧ•Χ¨:
ΧΧ¦Χ™Χ’Χ” ΧΧ Χ›Χ Χ”ΧΧ©ΧΧ•ΧΧ™Χ (Χ”Χ›Χ Χ΅Χ•Χ Χ•Χ”Χ•Χ¦ΧΧ•Χ) Χ›ΧΧ©Χ¨ Χ΅Χ›Χ•ΧΧ™ Χ”Χ”Χ•Χ¦ΧΧ•Χ ΧΧ•Χ¦Χ’Χ™Χ Χ›Χ΅Χ›Χ•Χ Χ©ΧΧ™ΧΧ™ β€“ ΧΧ¦Χ•Χ¨Χ Χ Χ™ΧΧ•Χ— ΧΧ§Χ¦Χ™Χ‘Χ™.
```sql
SELECT 
    p_date,
    employee_name,
    employee_role,
    payment_type,
    in_or_out,
    CASE 
        WHEN in_or_out = 'in' THEN p_sum
        ELSE -p_sum
    END AS signed_amount
FROM 
    view_employee_payments
ORDER BY 
    p_date DESC;
```
![](DBProject/Χ©ΧΧ‘%20Χ’/m2.2.png)

# Χ“Χ•Χ— Χ¤Χ¨Χ•Χ™Χ§Χ β€“ Χ©ΧΧ‘ Χ“

---
### Χ›Χ“Χ™ Χ©Χ”ΧΧ•Χ›Χ Χ™Χ ΧΧ”Χ™Χ” ΧΧ©ΧΧΆΧ•ΧΧ™Χ, Χ”Χ•Χ΅Χ¤Χ Χ• ΧΧ Χ”ΧΧ‘ΧΧ” 'summary_report'
Χ”ΧΧ‘ΧΧ” Χ Χ•ΧΆΧ“Χ” ΧΧ¨Χ›Χ– ΧΧ Χ΅Χ Χ›Χ Χ”ΧΧ©ΧΧ•ΧΧ™Χ Χ©Χ§Χ™Χ‘Χ Χ›Χ ΧΆΧ•Χ‘Χ“ Χ‘Χ›Χ Χ™Χ•Χ ΧΧ¦Χ•Χ¨Χ ΧΧΆΧ§Χ‘ Χ•Χ‘Χ§Χ¨Χ”.
Χ”Χ™Χ ΧΧΧΆΧ“Χ›Χ Χ ΧΧ•ΧΧ•ΧΧΧ™Χ Χ“Χ¨Χ ΧΧ¨Χ™Χ’Χ¨ Χ•Χ¤Χ¨Χ•Χ¦Χ“Χ•Χ¨Χ” Χ‘Χ›Χ Χ”Χ•Χ΅Χ¤Χ ΧΧ©ΧΧ•Χ Χ—Χ“Χ©.
```sql
CREATE TABLE summary_report (
    emp_id INTEGER,
    total_amount NUMERIC,
    report_date DATE,
    PRIMARY KEY (emp_id, report_date)
);
```
## Χ¤Χ•Χ Χ§Χ¦Χ™Χ” 1: Χ—Χ™Χ©Χ•Χ‘ Χ΅Χ”"Χ› ΧΧ©ΧΧ•Χ ΧΧΧ“Χ¨Χ™Χ ΧΧ¤Χ™ ΧΧ–Χ”Χ”

### ΧΧ™ΧΧ•Χ¨:
Χ¤Χ•Χ Χ§Χ¦Χ™Χ” Χ©ΧΧ—Χ–Χ™Χ¨Χ” REF CURSOR Χ©Χ Χ›Χ Χ”ΧΧ©ΧΧ•ΧΧ™Χ ΧΧΧ“Χ¨Χ™Χ ΧΧ΅Χ•Χ™Χ Χ•ΧΧ—Χ©Χ‘Χ ΧΧ Χ΅Χ›Χ•Χ Χ”ΧΧ©ΧΧ•ΧΧ™Χ Χ”Χ›Χ•ΧΧ.

### Χ§Χ•Χ“:
```sql
CREATE OR REPLACE FUNCTION fn_total_payment_for_guide(guide_id_input INTEGER)
RETURNS REFCURSOR AS $$
DECLARE
    total_sum NUMERIC := 0;
    rec RECORD;
    ref REFCURSOR;
BEGIN
    
    OPEN ref FOR 
        SELECT * FROM payment WHERE e_id = guide_id_input;


    FOR rec IN SELECT p_sum FROM payment WHERE e_id = guide_id_input LOOP
        total_sum := total_sum + rec.p_sum;
    END LOOP;

  
    RAISE NOTICE 'Total payment for guide ID %: %', guide_id_input, total_sum;

    RETURN ref;
END;
$$ LANGUAGE plpgsql;

```

### Χ”Χ•Χ›Χ—Χ Χ¨Χ™Χ¦Χ”:
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%93/%D7%94%D7%95%D7%9B%D7%97%D7%AA%20%D7%A8%D7%99%D7%A6%D7%94%20%D7%A4%D7%95%D7%A0%D7%A7%D7%A6%D7%99%D7%94%201.png)

---

## Χ¤Χ•Χ Χ§Χ¦Χ™Χ” 2: ΧΧ“Χ¨Χ™Χ›Χ™Χ ΧΆΧ Χ Χ™Χ΅Χ™Χ•Χ ΧΧΆΧ N Χ΅Χ™Χ•Χ¨Χ™Χ

### ΧΧ™ΧΧ•Χ¨:
ΧΧ—Χ–Χ™Χ¨Χ” ΧΧ‘ΧΧ” Χ©Χ ΧΧ“Χ¨Χ™Χ›Χ™Χ Χ©Χ‘Χ™Χ¦ΧΆΧ• Χ™Χ•ΧΧ¨ ΧΦΎN Χ΅Χ™Χ•Χ¨Χ™Χ.

### Χ§Χ•Χ“:
```sql
CREATE OR REPLACE FUNCTION fn_guides_with_experience(min_tours INTEGER)
RETURNS TABLE(e_id NUMERIC, e_name TEXT, guided_tours INTEGER) AS $$
BEGIN
    RETURN QUERY
    SELECT 
        employee.e_id,
        employee.e_name::TEXT,
        employee.guided_tours
    FROM employee
    WHERE employee.employee_role = 'guide' AND employee.guided_tours > min_tours;
END;
$$ LANGUAGE plpgsql;

```

### Χ”Χ•Χ›Χ—Χ Χ¨Χ™Χ¦Χ”:
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%93/%D7%94%D7%95%D7%9B%D7%97%D7%AA%20%D7%A8%D7%99%D7%A6%D7%94%20%D7%A4%D7%95%D7%A0%D7%A7%D7%A6%D7%99%D7%94%202%20.png)

---

## Χ¤Χ¨Χ•Χ¦Χ“Χ•Χ¨Χ” 1: ΧΆΧ“Χ›Χ•Χ ΧΧ¤Χ§Χ™Χ“ ΧΆΧ•Χ‘Χ“

### ΧΧ™ΧΧ•Χ¨:
Χ¤Χ¨Χ•Χ¦Χ“Χ•Χ¨Χ” Χ©Χ‘Χ•Χ“Χ§Χ ΧΧ Χ”ΧΆΧ•Χ‘Χ“ Χ§Χ™Χ™Χ Χ•ΧΧ Χ›Χ ΧΧΆΧ“Χ›Χ Χ ΧΧ ΧΧ¤Χ§Χ™Χ“Χ•, ΧΧ—Χ¨Χ Χ–Χ•Χ¨Χ§Χ Χ—Χ¨Χ™Χ’Χ”.

### Χ§Χ•Χ“:
```sql
CREATE OR REPLACE PROCEDURE pr_update_employee_role(emp_id INTEGER, new_role TEXT)
AS $$
BEGIN
 
    IF NOT EXISTS (SELECT 1 FROM employee WHERE e_id = emp_id) THEN
        RAISE EXCEPTION 'No such employee with ID: %', emp_id;
    END IF;

    UPDATE employee SET role = new_role WHERE e_id = emp_id;
    RAISE NOTICE 'Role updated successfully for employee %', emp_id;
END;
$$ LANGUAGE plpgsql;

```

### Χ”Χ•Χ›Χ—Χ Χ¨Χ™Χ¦Χ”:
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%93/%D7%94%D7%95%D7%9B%D7%97%D7%AA%20%D7%A8%D7%99%D7%A6%D7%94%20%D7%A4%D7%A8%D7%95%D7%A6%D7%93%D7%95%D7%A8%D7%94%201.png)

---

## Χ¤Χ¨Χ•Χ¦Χ“Χ•Χ¨Χ” 2: Χ“Χ•"Χ— ΧΧ©ΧΧ•ΧΧ™Χ ΧΧ›Χ ΧΆΧ•Χ‘Χ“

### ΧΧ™ΧΧ•Χ¨:
Χ™Χ•Χ¦Χ¨Χ ΧΧ• ΧΧΆΧ“Χ›Χ Χ Χ΅Χ™Χ›Χ•Χ ΧΧ©ΧΧ•ΧΧ™Χ ΧΧ¤Χ™ ΧΆΧ•Χ‘Χ“ Χ‘ΧΧΧ¨Χ™Χ Χ©Χ Χ”Χ™Χ•Χ, Χ›Χ•ΧΧ Χ©Χ™ΧΧ•Χ© Χ‘ΧΧ•ΧΧΧ” Χ•ΦΎDML.

### Χ§Χ•Χ“:
```sql
CREATE OR REPLACE PROCEDURE pr_generate_payment_summary()
AS $$
DECLARE
    r RECORD;
BEGIN
    FOR r IN SELECT e_id, SUM(p_sum) as total FROM payment GROUP BY e_id LOOP
        INSERT INTO summary_report(emp_id, total_amount, report_date)
        VALUES (r.e_id, r.total, CURRENT_DATE)
        ON CONFLICT (emp_id, report_date) DO UPDATE SET total_amount = r.total;
    END LOOP;
END;
$$ LANGUAGE plpgsql;
```

### Χ”Χ•Χ›Χ—Χ Χ¨Χ™Χ¦Χ”:
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%93/%D7%94%D7%95%D7%9B%D7%97%D7%AA%20%D7%A8%D7%99%D7%A6%D7%94%20%D7%A4%D7%A8%D7%95%D7%A6%D7%93%D7%95%D7%A8%D7%94%202.png)
---

## ΧΧ¨Χ™Χ’Χ¨ 1: Χ‘Χ“Χ™Χ§Χ Χ§Χ™Χ•Χ ΧΆΧ•Χ‘Χ“ ΧΧ¤Χ Χ™ Χ”Χ›Χ Χ΅Χ ΧΧ©ΧΧ•Χ

### Χ§Χ•Χ“:
```sql
CREATE OR REPLACE FUNCTION trg_check_employee_exists()
RETURNS TRIGGER AS $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM employee WHERE e_id = NEW.e_id) THEN
        RAISE EXCEPTION 'Employee ID % does not exist', NEW.e_id;
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_before_payment_insert
BEFORE INSERT ON payment
FOR EACH ROW EXECUTE FUNCTION trg_check_employee_exists();
```

---

## ΧΧ¨Χ™Χ’Χ¨ 2: ΧΆΧ“Χ›Χ•Χ summary_report ΧΧ—Χ¨Χ™ Χ”Χ›Χ Χ΅Χ ΧΧ©ΧΧ•Χ

### Χ§Χ•Χ“:
```sql
CREATE OR REPLACE FUNCTION trg_update_summary()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO summary_report(emp_id, total_amount, report_date)
    VALUES (NEW.e_id, NEW.p_sum, CURRENT_DATE)
    ON CONFLICT (emp_id, report_date)
    DO UPDATE SET total_amount = summary_report.total_amount + NEW.p_sum;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_after_payment_insert
AFTER INSERT ON payment
FOR EACH ROW EXECUTE FUNCTION trg_update_summary();
```

---

## ΧΧ•Χ›Χ Χ™Χ Χ¨ΧΧ©Χ™Χ 1: Χ”Χ¤ΧΆΧΧ Χ¤Χ•Χ Χ§Χ¦Χ™Χ” Χ•Χ¤Χ¨Χ•Χ¦Χ“Χ•Χ¨Χ”

```sql
DO $$
DECLARE
    c REFCURSOR;
BEGIN
    c := fn_total_payment_for_guide(2);      
    CALL pr_update_employee_role(2, 'admin'); 
END;
$$;

```
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%93/%D7%AA%D7%95%D7%A6%D7%90%D7%95%D7%AA%20%D7%94%D7%A8%D7%A6%D7%94%20%D7%AA%D7%95%D7%9B%D7%A0%D7%99%D7%AA%201.png)
---

## ΧΧ•Χ›Χ Χ™Χ Χ¨ΧΧ©Χ™Χ 2: Χ”Χ¤ΧΆΧΧ Χ¤Χ•Χ Χ§Χ¦Χ™Χ” 2 Χ•Χ¤Χ¨Χ•Χ¦Χ“Χ•Χ¨Χ” 2

```sql
DO $$
BEGIN
    CALL pr_generate_payment_summary();
    PERFORM * FROM fn_guides_with_experience(10);
END;
$$;
```
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%93/%D7%94%D7%95%D7%9B%D7%97%D7%AA%20%D7%A8%D7%99%D7%A6%D7%94%20%D7%AA%D7%95%D7%9B%D7%A0%D7%99%D7%AA%202.png)
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%93/%D7%AA%D7%95%D7%A6%D7%90%D7%95%D7%AA%20%D7%A8%D7%99%D7%A6%D7%94%20%D7%AA%D7%95%D7%9B%D7%A0%D7%99%D7%AA%202.png)

# Χ©ΧΧ‘ Χ”' β€“ ΧΧΆΧ¨Χ›Χ ΧΧ Χ™Χ”Χ•Χ ΧΆΧ•Χ‘Χ“Χ™Χ, Χ΅Χ™Χ•Χ¨Χ™Χ Χ•ΧΧ©ΧΧ•ΧΧ™Χ

ΧΧΆΧ¨Χ›Χ Χ–Χ• Χ Χ‘Χ ΧΧ” Χ‘Χ©Χ¤Χ Python ΧΆΧ Χ—Χ™Χ‘Χ•Χ¨ ΧΧΧ΅Χ“ PostgreSQL. Χ”ΧΧΆΧ¨Χ›Χ ΧΧΧ¤Χ©Χ¨Χ Χ Χ™Χ”Χ•Χ ΧΆΧ•Χ‘Χ“Χ™Χ, Χ΅Χ™Χ•Χ¨Χ™Χ, ΧΧΧ•Χ©Χ™ Χ©Χ›Χ¨ Χ•Χ“Χ•Χ—Χ•Χ Χ΅Χ™Χ›Χ•Χ Χ‘ΧΧ•Χ¤Χ Χ’Χ¨Χ¤Χ™ Χ•ΧΧ™Χ ΧΧ¨ΧΧ§ΧΧ™Χ‘Χ™.

---

## Χ”Χ•Χ¨ΧΧ•Χ Χ”Χ¤ΧΆΧΧ” Χ©Χ Χ”ΧΧ¤ΧΧ™Χ§Χ¦Χ™Χ”

1. Χ•Χ“Χ Χ©Χ”ΧΧΆΧ¨Χ›Χ ΧΆΧ•ΧΧ“Χ Χ‘Χ“Χ¨Χ™Χ©Χ•Χ Χ”Χ‘ΧΧ•Χ:
   - ΧΧ•ΧΧ§Χ Python 3.10+
   - ΧΧ΅Χ“ PostgreSQL Χ¤ΧΆΧ™Χ ΧΆΧ:
     - host: localhost
     - port: 5433
     - dbname: stage5
     - user: postgres
     - password: 16040010

2. Χ”Χ¤ΧΆΧ ΧΧ Χ”Χ§Χ•Χ‘Χ¥:
   ```
   python opening_screen.py
   ```

3. Χ™Χ•Χ¦Χ’ Χ΅Χ¨ΧΧ•Χ Χ¤ΧΧ™Χ—Χ”. Χ Χ™ΧΧ ΧΧΧ—Χ•Χ¥ "Χ“ΧΧ’" ΧΧ• ΧΧ”ΧΧΧ™Χ ΧΧ΅Χ™Χ•ΧΧ•. ΧΧΧ—Χ¨ ΧΧ›Χ Χ™Χ•Χ¦Χ’ Χ”ΧΧ΅Χ Χ”Χ¨ΧΧ©Χ™ Χ©Χ Χ”ΧΧΆΧ¨Χ›Χ.

---

## ΧΧ‘Χ Χ” Χ”ΧΧ΅Χ›Χ™Χ Χ•Χ”ΧΧΆΧ‘Χ¨Χ™Χ

### 1. opening_screen.py β€“ ΧΧ΅Χ Χ¤ΧΧ™Χ—Χ”
- ΧΧ¦Χ™Χ’ Χ΅Χ¨ΧΧ•Χ Χ•Χ™Χ“ΧΧ• Χ‘ΧΧ΅Χ ΧΧΧ.
- Χ›Χ¤ΧΧ•Χ¨ β€Χ“ΧΧ’β€ ΧΧΧ¤Χ©Χ¨ ΧΧΆΧ‘Χ¨ ΧΧ”Χ™Χ¨.
- Χ‘Χ΅Χ™Χ•Χ Χ”Χ΅Χ¨ΧΧ•Χ ΧΧ•Χ¦Χ’ Χ”ΧΧ΅Χ Χ”Χ¨ΧΧ©Χ™ Χ©Χ Χ”ΧΧΆΧ¨Χ›Χ (Landing Page).

### Χ”ΧΧ΅Χ Χ”Χ¨ΧΧ©Χ™ Χ©Χ Χ”ΧΧΆΧ¨Χ›Χ (Χ ΧΧ¦Χ Χ‘ΧΧ•Χ opening_screen.py)

ΧΧ¨Χ›Χ– Χ”Χ Χ™Χ•Χ•Χ Χ©Χ Χ”ΧΧΆΧ¨Χ›Χ β€“ ΧΧ›Χ™Χ 4 Χ›Χ¤ΧΧ•Χ¨Χ™Χ ΧΆΧ™Χ§Χ¨Χ™Χ™Χ:

#### Χ Χ™Χ”Χ•Χ ΧΆΧ•Χ‘Χ“Χ™Χ (employee.py)
- ΧΧ‘ΧΧ ΧΆΧ•Χ‘Χ“Χ™Χ: Χβ€Χ–, Χ©Χ, ΧΧ¤Χ§Χ™Χ“.
- Χ¤ΧΆΧ•ΧΧ•Χ: Χ”Χ•Χ΅Χ¤Χ”, ΧΆΧ“Χ›Χ•Χ, ΧΧ—Χ™Χ§Χ”.
- ΧΧ›Χ ΧΆΧ•Χ‘Χ“ Χ›Χ¤ΧΧ•Χ¨Χ™Χ:
  - Χ Χ™Χ”Χ•Χ ΧΧΧ•Χ©Χ™Χ (SalaryManager.py)
  - Χ Χ™Χ”Χ•Χ Χ΅Χ™Χ•Χ¨Χ™Χ (TourManagerApp.py)

#### Χ΅Χ™Χ›Χ•Χ ΧΧ©ΧΧ•ΧΧ™Χ (summary_screen.py)
- ΧΧ¤ΧΆΧ™Χ ΧΧ Χ”Χ¤Χ¨Χ•Χ¦Χ“Χ•Χ¨Χ” `pr_generate_payment_summary`
- ΧΧ¦Χ™Χ’ ΧΧ ΧΧ•Χ›Χ Χ”ΧΧ‘ΧΧ” `summary_report`

#### ΧΧ“Χ¨Χ™Χ›Χ™Χ ΧΆΧ Χ Χ™Χ΅Χ™Χ•Χ (guides_experience_screen.py)
- ΧΧ§Χ‘Χ ΧΧ”ΧΧ©ΧΧΧ© ΧΧ΅Χ¤Χ¨ Χ΅Χ™Χ•Χ¨Χ™Χ ΧΧ™Χ Χ™ΧΧΧ™
- ΧΧ¦Χ™Χ’ ΧΧ“Χ¨Χ™Χ›Χ™Χ ΧΆΧ Χ Χ™Χ΅Χ™Χ•Χ ΧΧΆΧ ΧΆΧ¨Χ Χ–Χ”
- ΧΧ©ΧΧΧ© Χ‘Χ¤Χ•Χ Χ§Χ¦Χ™Χ” `fn_guides_with_experience`

#### Χ’Χ¨Χ£ Χ”Χ©Χ•Χ•ΧΧΧ™ Χ‘Χ™Χ ΧΧ“Χ¨Χ™Χ›Χ™Χ (compare_visitors_guides.py)
- ΧΧ‘Χ¦ΧΆ Χ—Χ™Χ©Χ•Χ‘ Χ›ΧΧ•Χ ΧΧ©ΧΧΧ¤Χ™Χ ΧΧ¤Χ™ ΧΧ“Χ¨Χ™Χ
- ΧΧ¦Χ™Χ’ Χ’Χ¨Χ£ Χ‘ΧΧΧ¦ΧΆΧ•Χ matplotlib
- Χ Χ’Χ™Χ© ΧΧ”ΧΧ¤Χ¨Χ™Χ Χ”Χ¨ΧΧ©Χ™

---

## ΧΧ΅Χ›Χ™Χ Χ¤Χ Χ™ΧΧ™Χ™Χ Χ©Χ Χ¤ΧΧ—Χ™Χ ΧΧΧ•Χ employee.py

### SalaryManager.py β€“ Χ Χ™Χ”Χ•Χ ΧΧΧ•Χ©Χ™ Χ©Χ›Χ¨
- ΧΧ¦Χ™Χ’ ΧΧΧ•Χ©Χ™Χ ΧΧΆΧ•Χ‘Χ“ Χ Χ‘Χ—Χ¨
- Χ¤ΧΆΧ•ΧΧ•Χ: Χ”Χ•Χ΅Χ¤Χ”, ΧΆΧ“Χ›Χ•Χ, ΧΧ—Χ™Χ§Χ”
- Χ›Χ•ΧΧ Χ™Χ¦Χ•Χ ΧΧ§Χ•Χ‘Χ¥ Excel

### TourManagerApp.py β€“ Χ Χ™Χ”Χ•Χ Χ΅Χ™Χ•Χ¨Χ™Χ
- ΧΧ¦Χ™Χ’ ΧΧ Χ”Χ΅Χ™Χ•Χ¨Χ™Χ Χ©Χ Χ”ΧΧ“Χ¨Χ™Χ
- Χ¤ΧΆΧ•ΧΧ•Χ: Χ”Χ•Χ΅Χ¤Χ”, ΧΆΧ“Χ›Χ•Χ, ΧΧ—Χ™Χ§Χ”
- ΧΧ—Χ©Χ‘ Χ΅Χ Χ”Χ›Χ Χ΅Χ•Χ ΧΧ›Χ Χ΅Χ™Χ•Χ¨

---

## ΧΧΧ•Χ Χ•Χ ΧΧ΅Χ

### ΧΧ΅Χ Χ¤ΧΧ™Χ—Χ”  
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%94/opening_screen.png)

### ΧΧ¤Χ¨Χ™Χ Χ¨ΧΧ©Χ™  
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%94/selection_screen.png)

### Χ Χ™Χ”Χ•Χ ΧΆΧ•Χ‘Χ“Χ™Χ  
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%94/employee_management.png)

### Χ Χ™Χ”Χ•Χ ΧΧΧ•Χ©Χ™ Χ©Χ›Χ¨  
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%94/salary_reports.png)

### Χ“Χ•Χ— Χ΅Χ™Χ›Χ•Χ ΧΧ©ΧΧ•ΧΧ™Χ  
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%94/summary_reports.png)

### ΧΧ“Χ¨Χ™Χ›Χ™Χ ΧΆΧ Χ Χ™Χ΅Χ™Χ•Χ  
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%94/experienced_guides.png)

### Χ’Χ¨Χ£ Χ”Χ©Χ•Χ•ΧΧ ΧΧ“Χ¨Χ™Χ›Χ™Χ  
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%94/guide_comparison.png)

## Χ©ΧΧ™ΧΧΧ•Χ, Χ¤Χ¨Χ•Χ¦Χ“Χ•Χ¨Χ•Χ Χ•Χ¤Χ•Χ Χ§Χ¦Χ™Χ•Χ Χ‘Χ©Χ™ΧΧ•Χ© Χ‘Χ¤Χ•ΧΆΧ

### employee.py
- SELECT * FROM employee;
- INSERT INTO employee (...);
- UPDATE employee SET ...;
- DELETE FROM employee WHERE ...;

### SalaryManager.py
- SELECT payslip_number, neto_salary, payslip_date FROM salary WHERE e_id = %s;
- DELETE FROM salary WHERE payslip_number = %s;

### TourManagerApp.py
- SELECT tourid, price * amount AS total FROM tour WHERE guideid = %s;
- DELETE FROM tour WHERE tourid = %s;

### summary_screen.py
- CALL pr_generate_payment_summary();
- SELECT * FROM summary_report;

### guides_experience_screen.py
- SELECT * FROM fn_guides_with_experience(min_tours);

---

## Χ΅Χ™Χ›Χ•Χ

ΧΧΧ—Χ¨ Χ”Χ¦Χ’Χ Χ”Χ΅Χ¨ΧΧ•Χ, ΧΧ•Χ¦Χ’ ΧΧ¤Χ¨Χ™Χ Χ¨ΧΧ©Χ™ Χ©ΧΧ¨Χ›Χ– ΧΧ Χ›Χ Χ”Χ¨Χ›Χ™Χ‘Χ™Χ: Χ Χ™Χ”Χ•Χ ΧΆΧ•Χ‘Χ“Χ™Χ, ΧΧΧ•Χ©Χ™Χ, Χ΅Χ™Χ•Χ¨Χ™Χ Χ•Χ“Χ•Χ—Χ•Χ. Χ›Χ Χ›Χ¤ΧΧ•Χ¨ Χ¤Χ•ΧΧ— ΧΧΧ©Χ§ ΧΆΧ¦ΧΧΧ™, Χ”ΧΧ—Χ•Χ‘Χ¨ ΧΧΧ΅Χ“ Χ”Χ ΧΧ•Χ Χ™Χ Χ•ΧΧΧ¤Χ©Χ¨ ΧΆΧ‘Χ•Χ“Χ” ΧΧΧΧ” ΧΆΧ Χ”Χ ΧΧ•Χ Χ™Χ Χ‘Χ”ΧΧΧ ΧΧ¦Χ•Χ¨Χ.
