
# ××—×œ×§×ª ×›×¡×¤×™× - ×¤×¨×•×™×§×˜ ×‘×¡×™×¡×™ × ×ª×•× ×™×

**×©××•×ª ×”××’×™×©×•×ª:**  
- ×•×§× ×™×Ÿ ×”×“×¡ ××¡×ª×¨ â€“ 324966993  
- ×™×©×¨××œ×™ ×ª×”×™×œ×” â€“ 325119493  

**×©× ×”××¢×¨×›×ª:**  
× ×™×”×•×œ ×›×¡×¤×™× ×‘×™×§×‘  
**×”×™×—×™×“×” ×”× ×‘×—×¨×ª:**  
××—×œ×§×ª ×›×¡×¤×™×

---

## ×ª×•×›×Ÿ ×¢× ×™×™× ×™×

1. [××‘×•×](#××‘×•×)
2. [×ª×¨×©×™× ERD](#×ª×¨×©×™×-erd)
3. [×ª×¨×©×™× DSD](#×ª×¨×©×™×-dsd)
4. [×”×—×œ×˜×•×ª ×¢×™×¦×•×‘](#×”×—×œ×˜×•×ª-×¢×™×¦×•×‘)
5. [×©×™×˜×•×ª ×”×›× ×¡×ª × ×ª×•× ×™×](#×©×™×˜×•×ª-×”×›× ×¡×ª-× ×ª×•× ×™×)
6. [×’×™×‘×•×™ ×•×©×—×–×•×¨ × ×ª×•× ×™×](#×’×™×‘×•×™-×•×©×—×–×•×¨-× ×ª×•× ×™×)
7. [×©×œ×‘ ×‘ â€“ ×©××™×œ×ª×•×ª ×•×¢×“×›×•× ×™×](#×©×œ×‘-×‘--×©××™×œ×ª×•×ª-×•×¢×“×›×•× ×™×)

---

## ××‘×•×

### ×ª×™××•×¨ ×”× ×ª×•× ×™× ×”× ×©××¨×™× ×‘××¢×¨×›×ª:

1. **×˜×‘×œ×ª ×ª×©×œ×•××™× (payment)** â€“ ××–×”×”, ×¡×›×•×, ×ª××¨×™×š, ×¡×•×’ (×”×›× ×¡×”/×”×•×¦××”)
2. **×˜×‘×œ×ª ×¢×•×‘×“×™× (employee)** â€“ ××–×”×”, ×©×, ×ª××¨×™×š ×”×ª×—×œ×”, ×©×›×¨
3. **×˜×‘×œ×ª ×ª×§×¦×™×‘×™× (budgets)** â€“ ×©× ×”, ×¡×›×•×
4. **×˜×‘×œ×ª ×”×©×§×¢×•×ª (investments)** â€“ ××–×”×” ×”×©×§×¢×”, ××©×§×™×¢, ×¡×›×•×, ×ª×©×•××”
5. **×˜×‘×œ×ª ×¨×›×™×©×•×ª (purchases)** â€“ ××™×“×¢ ×¢×œ ××” × ×¨×›×©, ×›××”, ×•××™ ×¨×›×©
6. **×˜×‘×œ×ª ××™×¡×™× (taxes)** â€“ ×¡×›×•×, ××—×•×–, ×›×œ×œ×™× ××©×ª× ×™×
7. **×˜×‘×œ×ª ××©×›×•×¨×•×ª (salary)** â€“ ×‘×¨×•×˜×•, × ×˜×•, ×”×¤×¨×©×™× ××•×œ ××¡

### ×”×¤×•× ×§×¦×™×•× ×œ×™×•×ª ×”×¢×™×§×¨×™×ª ×‘××¢×¨×›×ª:

- ×§×™×©×•×¨ ×ª×©×œ×•× ×œ×”×©×§×¢×•×ª / ×¨×›×™×©×•×ª / ××©×›×•×¨×•×ª
- ×—×™×©×•×‘ ×©×›×¨ × ×˜×• ×œ××—×¨ × ×™×›×•×™ ××¡
- × ×™×”×•×œ ×ª×§×¦×™×‘ ××•×œ ×”×›× ×¡×•×ª ×•×”×•×¦××•×ª ×‘×¤×•×¢×œ
- ××¢×§×‘ ××—×¨ ×¨×›×™×©×•×ª ×œ×¤×™ ×¦×¨×›×Ÿ, ×›××•×ª ×•××—×™×¨
- ×—×™×©×•×‘ ××¡×™× ×œ×¤×™ ×—×•×§×™× ××•×ª×××™×

---

## ×ª×¨×©×™× ERD

![ERD](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/ERD.png?raw=true)

---

## ×ª×¨×©×™× DSD

![DSD](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/DSD.png?raw=true)

---

## ×”×—×œ×˜×•×ª ×¢×™×¦×•×‘

1. ×¨×™×›×•×– ×›×œ ×¡×•×’×™ ×”×ª×©×œ×•××™× ×‘×˜×‘×œ×” ××—×ª (`payment`) ×œ× ×™×”×•×œ ××—×™×“ ×•×§×œ.
2. ×§×™×©×•×¨ ×™×©×™×¨ ×‘×™×Ÿ `payment` ×œ×‘×™×Ÿ ×”×©×§×¢×•×ª, ×¨×›×™×©×•×ª ×•××©×›×•×¨×•×ª â€“ ×œ×©× ××¢×§×‘ ×‘×¨×•×¨ ××—×¨×™ ××§×•×¨ ×”×”×•×¦××”/×”×›× ×¡×”.
3. ×¤×™×¦×•×œ ×¨×›×™×©×•×ª ×œ×¨×›×™×©×•×ª ×›×œ×œ×™×•×ª ×•×¨×›×™×‘×™ ×¨×›×™×©×” â€“ ×œ×¤×™×¨×•×˜ ××œ× ×©×œ ××” × ×§× ×”.
4. ×”×¤×¨×“×ª ××©×›×•×¨×•×ª â€“ ×××¤×©×¨×ª ×œ×—×©×‘ ×©×›×¨ × ×˜×• ×œ×¤×™ ×—×•×§×™ ××¡ ××©×ª× ×™×.
5. ×©×™××•×© ×‘×˜×‘×œ×ª ×ª×§×¦×™×‘×™× â€“ ×œ××¢×§×‘ ×©× ×ª×™ ×•×œ×”×©×•×•××” ××•×œ ×”×•×¦××•×ª.
6. ×©××™×¨×ª ××—×•×–×™ ××¡ ×‘×˜×‘×œ×” × ×¤×¨×“×ª â€“ ×›×š × ×™×ª×Ÿ ×œ×¢×“×›×Ÿ ×—×•×§×™× ×‘×œ×™ ×œ×©× ×•×ª ××ª ××‘× ×” ×”×˜×‘×œ××•×ª.

---

## ×©×™×˜×•×ª ×”×›× ×¡×ª × ×ª×•× ×™×

### 1. ×©×™××•×© ×‘Ö¾Mockaroo

[mockarooFiles](https://github.com/estisellam/department-finance---winery/tree/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/mockarooFiles)

### 2. ×©×™××•×© ×‘Ö¾GENERATEDATA

[generatedataFiles](https://github.com/estisellam/department-finance---winery/tree/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/generatedataFiles)

### 3. ×¡×§×¨×™×¤×˜ ×‘Ö¾Python

[scripts folder](https://github.com/estisellam/department-finance---winery/tree/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/python_script)

---

## ×’×™×‘×•×™ ×•×©×—×–×•×¨ × ×ª×•× ×™×

![Backup](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/%D7%A6%D7%99%D7%9C%D7%95%D7%9D%20%D7%9E%D7%A1%D7%9A%202025-05-02%20%D7%91-9.34.22.png?raw=true)

**×§×•×‘×¥ ×”×’×™×‘×•×™:** `gibuy.sql`  
**×§×•×‘×¥ ×”×©×—×–×•×¨:** `insertTables.sql`  
×‘×•×¦×¢ ×©×™××•×© ×‘Ö¾pgAdmin ×œ×™×™×¦×•× ×•×©×—×–×•×¨ ×”× ×ª×•× ×™×.

---

## ×©×œ×‘ ×‘ â€“ ×©××™×œ×ª×•×ª ×•×¢×“×›×•× ×™×


## ğŸ”¹ ×©××™×œ×ª×•×ª UPDATE

### 1. ×¢×“×›×•×Ÿ ××—×•×– ×¨×•×•×— ×œ××©×§×™×¢×™× ×¢× ×ª×©×œ×•× ××¢×œ 10,000
```sql
UPDATE Investments
SET profit_Percentage = 15
WHERE id_Investor IN (
  SELECT ii.id_Investor
  FROM in_Investments ii
  NATURAL JOIN payment p
  WHERE p.p_sum > 10000
);
```
![×œ×¤× ×™](./×©×œ×‘%20×‘/update01-before.png)
![×”×¨×¦×”](./×©×œ×‘%20×‘/update01-run.png)
![××—×¨×™](./×©×œ×‘%20×‘/update01-after.png)

---

### 2. ×”×¢×œ××ª ×©×›×¨ ×‘Ö¾10% ×œ×¢×•×‘×“×™× ×¢× 3+ ×ª×œ×•×©×™ ×©×›×¨
```sql
UPDATE employee
SET salary = salary * 1.10
WHERE e_id IN (
  SELECT e_id
  FROM salary
  GROUP BY e_id
  HAVING COUNT(*) >= 3
);
```
![×œ×¤× ×™](./×©×œ×‘%20×‘/update02-before.png)
![×”×¨×¦×”](./×©×œ×‘%20×‘/update02-run.png)
![××—×¨×™](./×©×œ×‘%20×‘/update02-after.png)

---

### 3. ×”×•×¨×“×ª ××—×•×– ××¡ ×œÖ¾8% ×¢×‘×•×¨ ×ª×©×œ×•××™× ×Ö¾2022
```sql
UPDATE taxes
SET percent = 8
WHERE t_id IN (
  SELECT ot.t_id
  FROM out_taxes ot
  NATURAL JOIN payment p
  WHERE p.p_year = 2022
);
```
![×œ×¤× ×™](./×©×œ×‘%20×‘/update03-before.png)
![×”×¨×¦×”](./×©×œ×‘%20×‘/update03-run.png)
![××—×¨×™](./×©×œ×‘%20×‘/update03-after.png)

---

## ğŸ”¹ ×©×™××•×© ×‘Ö¾ROLLBACK
```sql
BEGIN;
UPDATE employee
SET salary = salary + 123
WHERE e_id = 200;
ROLLBACK;
```
![×œ×¤× ×™](./×©×œ×‘%20×‘/rollback-before.png)
![×”×¨×¦×”](./×©×œ×‘%20×‘/rollback-run.png)
![×ª×•×¦××”](./×©×œ×‘%20×‘/rollback-result.png)

---

## ğŸ”¹ ×©×™××•×© ×‘Ö¾COMMIT
```sql
BEGIN;
UPDATE employee
SET salary = salary + 123
WHERE e_id = 200;
COMMIT;
```
![×œ×¤× ×™](./×©×œ×‘%20×‘/commit-before.png)
![×”×¨×¦×”](./×©×œ×‘%20×‘/commit-run.png)
![×ª×•×¦××”](./×©×œ×‘%20×‘/commit-result.png)

---

## ğŸ”¹ ××™×œ×•×¦×™×

### 1. NOT NULL ×¢×œ ×ª××¨×™×š ×‘×ª×©×œ×•××™× (payment.p_date)
```sql
ALTER TABLE payment
ALTER COLUMN p_date SET NOT NULL;

-- × ×™×¡×™×•×Ÿ ×”×¤×¨×”
INSERT INTO payment (p_id, p_date, p_sum, in_or_out)
VALUES (501, NULL, 5000, 'in');
```
![××™×œ×•×¥ 1](./×©×œ×‘%20×‘/constraint1-error.png)

---

### 2. CHECK â€“ ×¡×›×•× ×ª×©×œ×•× ×’×“×•×œ ×××¤×¡ (payment.p_sum > 0)
```sql
ALTER TABLE payment
ADD CONSTRAINT check_positive_payment
CHECK (p_sum > 0);

-- × ×™×¡×™×•×Ÿ ×”×¤×¨×”
INSERT INTO payment (p_id, p_date, p_sum, in_or_out)
VALUES (502, '2023-01-01', 0, 'in');
```
![××™×œ×•×¥ 2](./×©×œ×‘%20×‘/constraint2-error.png)

---

### 3. DEFAULT ×¢×œ taxes.percent
```sql
ALTER TABLE taxes
ALTER COLUMN percent SET DEFAULT 17;

-- ×‘×“×™×§×”
INSERT INTO taxes (t_id, taxname, principal_amount)
VALUES (999, '××¡ × ×™×¡×™×•×Ÿ', 10000);
```
![××™×œ×•×¥ 3](./×©×œ×‘%20×‘/constraint3-default.png)

---

## ğŸ”¹ ×©××™×œ×ª×•×ª SELECT (5â€“8)

### 5. ×¢×•×‘×“×™× ×¢× ×©×›×¨ ×’×‘×•×” ×•××—×¨×™×•×ª ×œÖ¾3+ ×ª×©×œ×•××™×
```sql
SELECT e.e_id, e.e_name, e.salary
FROM employee e
NATURAL JOIN payment p
GROUP BY e.e_id, e.e_name, e.salary
HAVING e.salary > 10000 AND COUNT(p.p_id) > 3;
```
![before](./×©×œ×‘%20×‘/select05-before.png)
![run](./×©×œ×‘%20×‘/select05-run.png)
![result](./×©×œ×‘%20×‘/select05-result.png)

---

### 6. ×›×œ ×”×”×›× ×¡×•×ª ×œ×©× ×ª 2023
```sql
SELECT p.*
FROM payment p 
JOIN budgets b ON p.p_year = b.b_year 
WHERE p.p_year = 2023 AND p.in_or_out = 'in';
```
![before](./×©×œ×‘%20×‘/select06-before.png)
![run](./×©×œ×‘%20×‘/select06-run.png)
![result](./×©×œ×‘%20×‘/select06-result.png)

---

### 7. ×¢×•×‘×“×™× ×¢× ×”×¤×¨×© ×©×›×¨ × ×˜×• â‰¤ 2000
```sql
SELECT e.e_id, e.e_name, e.salary, s.neto_salary
FROM employee e
NATURAL JOIN salary s
WHERE (e.salary - s.neto_salary) <= 2000;
```
![before](./×©×œ×‘%20×‘/select07-before.png)
![run](./×©×œ×‘%20×‘/select07-run.png)
![result](./×©×œ×‘%20×‘/select07-result.png)

---

### 8. ×¦×¨×›× ×™× ×¢× ×¤×—×•×ª ×Ö¾2 ×¨×›×™×©×•×ª ×‘Ö¾2023
```sql
SELECT i.id_Consumer, COUNT(*) AS total_purchases
FROM in_Purchases_from i
NATURAL JOIN payment p
WHERE EXTRACT(YEAR FROM p.p_date) = 2023
GROUP BY i.id_Consumer
HAVING COUNT(*) < 2;
```
![before](./×©×œ×‘%20×‘/select08-before.png)
![run](./×©×œ×‘%20×‘/select08-run.png)
![result](./×©×œ×‘%20×‘/select08-result.png)

---

## ğŸ”¹ ×©××™×œ×ª×•×ª UPDATE

### 1. ×¢×“×›×•×Ÿ ××—×•×– ×¨×•×•×— ×œ××©×§×™×¢×™× ×¢× ×ª×©×œ×•× ××¢×œ 10,000
```sql
UPDATE Investments
SET profit_Percentage = 15
WHERE id_Investor IN (
  SELECT ii.id_Investor
  FROM in_Investments ii
  NATURAL JOIN payment p
  WHERE p.p_sum > 10000
);
```
![×œ×¤× ×™](./×©×œ×‘%20×‘/update01-before.png)
![×”×¨×¦×”](./×©×œ×‘%20×‘/update01-run.png)
![××—×¨×™](./×©×œ×‘%20×‘/update01-after.png)

---

### 2. ×”×¢×œ××ª ×©×›×¨ ×‘Ö¾10% ×œ×¢×•×‘×“×™× ×¢× 3+ ×ª×œ×•×©×™ ×©×›×¨
```sql
UPDATE employee
SET salary = salary * 1.10
WHERE e_id IN (
  SELECT e_id
  FROM salary
  GROUP BY e_id
  HAVING COUNT(*) >= 3
);
```
![×œ×¤× ×™](./×©×œ×‘%20×‘/update02-before.png)
![×”×¨×¦×”](./×©×œ×‘%20×‘/update02-run.png)
![××—×¨×™](./×©×œ×‘%20×‘/update02-after.png)

---

### 3. ×”×•×¨×“×ª ××—×•×– ××¡ ×œÖ¾8% ×¢×‘×•×¨ ×ª×©×œ×•××™× ×Ö¾2022
```sql
UPDATE taxes
SET percent = 8
WHERE t_id IN (
  SELECT ot.t_id
  FROM out_taxes ot
  NATURAL JOIN payment p
  WHERE p.p_year = 2022
);
```
![×œ×¤× ×™](./×©×œ×‘%20×‘/update03-before.png)
![×”×¨×¦×”](./×©×œ×‘%20×‘/update03-run.png)
![××—×¨×™](./×©×œ×‘%20×‘/update03-after.png)

---

## ğŸ”¹ ×©×™××•×© ×‘Ö¾ROLLBACK
```sql
BEGIN;
UPDATE employee
SET salary = salary + 123
WHERE e_id = 200;
ROLLBACK;
```
![×œ×¤× ×™](./×©×œ×‘%20×‘/rollback-before.png)
![×”×¨×¦×”](./×©×œ×‘%20×‘/rollback-run.png)
![×ª×•×¦××”](./×©×œ×‘%20×‘/rollback-result.png)

---

## ğŸ”¹ ×©×™××•×© ×‘Ö¾COMMIT
```sql
BEGIN;
UPDATE employee
SET salary = salary + 123
WHERE e_id = 200;
COMMIT;
```
![×œ×¤× ×™](./×©×œ×‘%20×‘/commit-before.png)
![×”×¨×¦×”](./×©×œ×‘%20×‘/commit-run.png)
![×ª×•×¦××”](./×©×œ×‘%20×‘/commit-result.png)

---

## ğŸ”¹ ××™×œ×•×¦×™×

### 1. NOT NULL ×¢×œ ×ª××¨×™×š ×‘×ª×©×œ×•××™× (payment.p_date)
```sql
ALTER TABLE payment
ALTER COLUMN p_date SET NOT NULL;

-- × ×™×¡×™×•×Ÿ ×”×¤×¨×”
INSERT INTO payment (p_id, p_date, p_sum, in_or_out)
VALUES (501, NULL, 5000, 'in');
```
![××™×œ×•×¥ 1](./×©×œ×‘%20×‘/constraint1-error.png)

---

### 2. CHECK â€“ ×¡×›×•× ×ª×©×œ×•× ×’×“×•×œ ×××¤×¡ (payment.p_sum > 0)
```sql
ALTER TABLE payment
ADD CONSTRAINT check_positive_payment
CHECK (p_sum > 0);

-- × ×™×¡×™×•×Ÿ ×”×¤×¨×”
INSERT INTO payment (p_id, p_date, p_sum, in_or_out)
VALUES (502, '2023-01-01', 0, 'in');
```
![××™×œ×•×¥ 2](./×©×œ×‘%20×‘/constraint2-error.png)

---

### 3. DEFAULT ×¢×œ taxes.percent
```sql
ALTER TABLE taxes
ALTER COLUMN percent SET DEFAULT 17;

-- ×‘×“×™×§×”
INSERT INTO taxes (t_id, taxname, principal_amount)
VALUES (999, '××¡ × ×™×¡×™×•×Ÿ', 10000);
```
![××™×œ×•×¥ 3](./×©×œ×‘%20×‘/constraint3-default.png)
