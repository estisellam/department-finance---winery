
# ΧΧ—ΧΧ§Χ Χ›Χ΅Χ¤Χ™Χ - Χ¤Χ¨Χ•Χ™Χ§Χ Χ‘Χ΅Χ™Χ΅Χ™ Χ ΧΧ•Χ Χ™Χ

**Χ©ΧΧ•Χ Χ”ΧΧ’Χ™Χ©Χ•Χ:**  
- Χ•Χ§Χ Χ™Χ Χ”Χ“Χ΅ ΧΧ΅ΧΧ¨ β€“ 324966993  
- Χ™Χ©Χ¨ΧΧΧ™ ΧΧ”Χ™ΧΧ” β€“ 325119493  

**Χ©Χ Χ”ΧΧΆΧ¨Χ›Χ:**  
Χ Χ™Χ”Χ•Χ Χ›Χ΅Χ¤Χ™Χ Χ‘Χ™Χ§Χ‘  
**Χ”Χ™Χ—Χ™Χ“Χ” Χ”Χ Χ‘Χ—Χ¨Χ:**  
ΧΧ—ΧΧ§Χ Χ›Χ΅Χ¤Χ™Χ

---

## ΧΧ•Χ›Χ ΧΆΧ Χ™Χ™Χ Χ™Χ

1. [ΧΧ‘Χ•Χ](#ΧΧ‘Χ•Χ)
2. [ΧΧ¨Χ©Χ™Χ ERD](#ΧΧ¨Χ©Χ™Χ-erd)
3. [ΧΧ¨Χ©Χ™Χ DSD](#ΧΧ¨Χ©Χ™Χ-dsd)
4. [Χ”Χ—ΧΧΧ•Χ ΧΆΧ™Χ¦Χ•Χ‘](#Χ”Χ—ΧΧΧ•Χ-ΧΆΧ™Χ¦Χ•Χ‘)
5. [Χ©Χ™ΧΧ•Χ Χ”Χ›Χ Χ΅Χ Χ ΧΧ•Χ Χ™Χ](#Χ©Χ™ΧΧ•Χ-Χ”Χ›Χ Χ΅Χ-Χ ΧΧ•Χ Χ™Χ)
6. [Χ’Χ™Χ‘Χ•Χ™ Χ•Χ©Χ—Χ–Χ•Χ¨ Χ ΧΧ•Χ Χ™Χ](#Χ’Χ™Χ‘Χ•Χ™-Χ•Χ©Χ—Χ–Χ•Χ¨-Χ ΧΧ•Χ Χ™Χ)

---

## ΧΧ‘Χ•Χ

### ΧΧ™ΧΧ•Χ¨ Χ”Χ ΧΧ•Χ Χ™Χ Χ”Χ Χ©ΧΧ¨Χ™Χ Χ‘ΧΧΆΧ¨Χ›Χ:

1. **ΧΧ‘ΧΧ ΧΧ©ΧΧ•ΧΧ™Χ (payment)** β€“ ΧΧ–Χ”Χ”, Χ΅Χ›Χ•Χ, ΧΧΧ¨Χ™Χ, Χ΅Χ•Χ’ (Χ”Χ›Χ Χ΅Χ”/Χ”Χ•Χ¦ΧΧ”)
2. **ΧΧ‘ΧΧ ΧΆΧ•Χ‘Χ“Χ™Χ (employee)** β€“ ΧΧ–Χ”Χ”, Χ©Χ, ΧΧΧ¨Χ™Χ Χ”ΧΧ—ΧΧ”, Χ©Χ›Χ¨
3. **ΧΧ‘ΧΧ ΧΧ§Χ¦Χ™Χ‘Χ™Χ (budgets)** β€“ Χ©Χ Χ”, Χ΅Χ›Χ•Χ
4. **ΧΧ‘ΧΧ Χ”Χ©Χ§ΧΆΧ•Χ (investments)** β€“ ΧΧ–Χ”Χ” Χ”Χ©Χ§ΧΆΧ”, ΧΧ©Χ§Χ™ΧΆ, Χ΅Χ›Χ•Χ, ΧΧ©Χ•ΧΧ”
5. **ΧΧ‘ΧΧ Χ¨Χ›Χ™Χ©Χ•Χ (purchases)** β€“ ΧΧ™Χ“ΧΆ ΧΆΧ ΧΧ” Χ Χ¨Χ›Χ©, Χ›ΧΧ”, Χ•ΧΧ™ Χ¨Χ›Χ©
6. **ΧΧ‘ΧΧ ΧΧ™Χ΅Χ™Χ (taxes)** β€“ Χ΅Χ›Χ•Χ, ΧΧ—Χ•Χ–, Χ›ΧΧΧ™Χ ΧΧ©ΧΧ Χ™Χ
7. **ΧΧ‘ΧΧ ΧΧ©Χ›Χ•Χ¨Χ•Χ (salary)** β€“ Χ‘Χ¨Χ•ΧΧ•, Χ ΧΧ•, Χ”Χ¤Χ¨Χ©Χ™Χ ΧΧ•Χ ΧΧ΅

### Χ”Χ¤Χ•Χ Χ§Χ¦Χ™Χ•Χ ΧΧ™Χ•Χ Χ”ΧΆΧ™Χ§Χ¨Χ™Χ Χ‘ΧΧΆΧ¨Χ›Χ:

- Χ§Χ™Χ©Χ•Χ¨ ΧΧ©ΧΧ•Χ ΧΧ”Χ©Χ§ΧΆΧ•Χ / Χ¨Χ›Χ™Χ©Χ•Χ / ΧΧ©Χ›Χ•Χ¨Χ•Χ
- Χ—Χ™Χ©Χ•Χ‘ Χ©Χ›Χ¨ Χ ΧΧ• ΧΧΧ—Χ¨ Χ Χ™Χ›Χ•Χ™ ΧΧ΅
- Χ Χ™Χ”Χ•Χ ΧΧ§Χ¦Χ™Χ‘ ΧΧ•Χ Χ”Χ›Χ Χ΅Χ•Χ Χ•Χ”Χ•Χ¦ΧΧ•Χ Χ‘Χ¤Χ•ΧΆΧ
- ΧΧΆΧ§Χ‘ ΧΧ—Χ¨ Χ¨Χ›Χ™Χ©Χ•Χ ΧΧ¤Χ™ Χ¦Χ¨Χ›Χ, Χ›ΧΧ•Χ Χ•ΧΧ—Χ™Χ¨
- Χ—Χ™Χ©Χ•Χ‘ ΧΧ΅Χ™Χ ΧΧ¤Χ™ Χ—Χ•Χ§Χ™Χ ΧΧ•ΧΧΧΧ™Χ

---

## ΧΧ¨Χ©Χ™Χ ERD

![ERD](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/ERD.png?raw=true)

---

## ΧΧ¨Χ©Χ™Χ DSD

![DSD](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/DSD.png?raw=true)

---

## Χ”Χ—ΧΧΧ•Χ ΧΆΧ™Χ¦Χ•Χ‘

1. Χ¨Χ™Χ›Χ•Χ– Χ›Χ Χ΅Χ•Χ’Χ™ Χ”ΧΧ©ΧΧ•ΧΧ™Χ Χ‘ΧΧ‘ΧΧ” ΧΧ—Χ (`payment`) ΧΧ Χ™Χ”Χ•Χ ΧΧ—Χ™Χ“ Χ•Χ§Χ.
2. Χ§Χ™Χ©Χ•Χ¨ Χ™Χ©Χ™Χ¨ Χ‘Χ™Χ `payment` ΧΧ‘Χ™Χ Χ”Χ©Χ§ΧΆΧ•Χ, Χ¨Χ›Χ™Χ©Χ•Χ Χ•ΧΧ©Χ›Χ•Χ¨Χ•Χ β€“ ΧΧ©Χ ΧΧΆΧ§Χ‘ Χ‘Χ¨Χ•Χ¨ ΧΧ—Χ¨Χ™ ΧΧ§Χ•Χ¨ Χ”Χ”Χ•Χ¦ΧΧ”/Χ”Χ›Χ Χ΅Χ”.
3. Χ¤Χ™Χ¦Χ•Χ Χ¨Χ›Χ™Χ©Χ•Χ ΧΧ¨Χ›Χ™Χ©Χ•Χ Χ›ΧΧΧ™Χ•Χ Χ•Χ¨Χ›Χ™Χ‘Χ™ Χ¨Χ›Χ™Χ©Χ” β€“ ΧΧ¤Χ™Χ¨Χ•Χ ΧΧΧ Χ©Χ ΧΧ” Χ Χ§Χ Χ”.
4. Χ”Χ¤Χ¨Χ“Χ ΧΧ©Χ›Χ•Χ¨Χ•Χ β€“ ΧΧΧ¤Χ©Χ¨Χ ΧΧ—Χ©Χ‘ Χ©Χ›Χ¨ Χ ΧΧ• ΧΧ¤Χ™ Χ—Χ•Χ§Χ™ ΧΧ΅ ΧΧ©ΧΧ Χ™Χ.
5. Χ©Χ™ΧΧ•Χ© Χ‘ΧΧ‘ΧΧ ΧΧ§Χ¦Χ™Χ‘Χ™Χ β€“ ΧΧΧΆΧ§Χ‘ Χ©Χ ΧΧ™ Χ•ΧΧ”Χ©Χ•Χ•ΧΧ” ΧΧ•Χ Χ”Χ•Χ¦ΧΧ•Χ.
6. Χ©ΧΧ™Χ¨Χ ΧΧ—Χ•Χ–Χ™ ΧΧ΅ Χ‘ΧΧ‘ΧΧ” Χ Χ¤Χ¨Χ“Χ β€“ Χ›Χ Χ Χ™ΧΧ ΧΧΆΧ“Χ›Χ Χ—Χ•Χ§Χ™Χ Χ‘ΧΧ™ ΧΧ©Χ Χ•Χ ΧΧ ΧΧ‘Χ Χ” Χ”ΧΧ‘ΧΧΧ•Χ.

---

## Χ©Χ™ΧΧ•Χ Χ”Χ›Χ Χ΅Χ Χ ΧΧ•Χ Χ™Χ

### 1. Χ©Χ™ΧΧ•Χ© Χ‘ΦΎMockaroo

[mockarooFiles](https://github.com/estisellam/department-finance---winery/tree/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/mockarooFiles)

### 2. Χ©Χ™ΧΧ•Χ© Χ‘ΦΎGENERATEDATA

[generatedataFiles](https://github.com/estisellam/department-finance---winery/tree/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/generatedataFiles)

### 3. Χ΅Χ§Χ¨Χ™Χ¤Χ Χ‘ΦΎPython

[scripts folder](https://github.com/estisellam/department-finance---winery/tree/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/python_script)

---

## Χ’Χ™Χ‘Χ•Χ™ Χ•Χ©Χ—Χ–Χ•Χ¨ Χ ΧΧ•Χ Χ™Χ

![Backup](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/%D7%A6%D7%99%D7%9C%D7%95%D7%9D%20%D7%9E%D7%A1%D7%9A%202025-05-02%20%D7%91-9.34.22.png?raw=true)

**Χ§Χ•Χ‘Χ¥ Χ”Χ’Χ™Χ‘Χ•Χ™:** `gibuy.sql`  
**Χ§Χ•Χ‘Χ¥ Χ”Χ©Χ—Χ–Χ•Χ¨:** `insertTables.sql`  
Χ‘Χ•Χ¦ΧΆ Χ©Χ™ΧΧ•Χ© Χ‘ΦΎpgAdmin ΧΧ™Χ™Χ¦Χ•Χ Χ•Χ©Χ—Χ–Χ•Χ¨ Χ”Χ ΧΧ•Χ Χ™Χ.

---
# Χ“Χ•Χ— Χ¤Χ¨Χ•Χ™Χ§Χ β€“ Χ©ΧΧ‘ Χ‘

## π”Ή Χ©ΧΧ™ΧΧΧ•Χ SELECT

### 1. ΧΆΧ•Χ‘Χ“Χ™Χ Χ©ΧΧ—Χ¨ΧΧ™Χ ΧΆΧ Χ”Χ©Χ§ΧΆΧ•Χ
```sql
SELECT DISTINCT e.e_id, e.e_name
FROM employee e
NATURAL JOIN payment p
NATURAL JOIN in_Investments i
ORDER BY e.e_name ASC;
```

### 2. Χ¨Χ›Χ™Χ©Χ•Χ Χ‘ΧΧΧ¨Χ™Χ 15.6.2023
```sql
SELECT p.p_id, p.p_date, i.id_Consumer
FROM payment p
NATURAL JOIN in_Purchases_from i
WHERE p.p_date = '2023-06-15';
```

### 3. ΧΆΧ•Χ‘Χ“Χ™Χ Χ©Χ”Χ—ΧΧ• ΧΧΆΧ‘Χ•Χ“ ΧΧ¤Χ Χ™ 2020
```sql
SELECT e_id, e_name, job_start_date
FROM employee
WHERE job_start_date < '2020-01-01'
ORDER BY job_start_date ASC;
```

### 4. Χ΅Χ›Χ•Χ ΧΧ©ΧΧ•ΧΧ™Χ Χ Χ›Χ Χ΅Χ™Χ ΧΧ¤Χ™ Χ©Χ Χ”
```sql
SELECT p_year, SUM(p_sum) AS total_income
FROM payment
WHERE in_or_out = 'in'
GROUP BY p_year
ORDER BY p_year;
```

### 5. ΧΆΧ•Χ‘Χ“Χ™Χ ΧΆΧ Χ©Χ›Χ¨ Χ’Χ‘Χ•Χ” Χ•ΧΧ—Χ¨Χ™Χ•Χ ΧΦΎ3+ ΧΧ©ΧΧ•ΧΧ™Χ
```sql
SELECT e.e_id, e.e_name, e.salary
FROM employee e
NATURAL JOIN payment p
GROUP BY e.e_id, e.e_name, e.salary
HAVING e.salary > 10000 AND COUNT(p.p_id) > 3;
```

### 6. Χ›Χ Χ”Χ”Χ›Χ Χ΅Χ•Χ ΧΧ©Χ Χ 2023
```sql
SELECT p.*
FROM payment p 
JOIN budgets b ON p.p_year = b.b_year 
WHERE p.p_year = 2023 AND p.in_or_out = 'in';
```

### 7. ΧΆΧ•Χ‘Χ“Χ™Χ ΧΆΧ Χ”Χ¤Χ¨Χ© Χ©Χ›Χ¨ Χ ΧΧ• β‰¤ 2000
```sql
SELECT e.e_id, e.name, e.salary, s.neto_salary
FROM employee e
NATURAL JOIN salary s
WHERE (e.salary - s.neto_salary) <= 2000;
```

### 8. Χ¦Χ¨Χ›Χ Χ™Χ ΧΆΧ Χ¤Χ—Χ•Χ ΧΦΎ2 Χ¨Χ›Χ™Χ©Χ•Χ Χ‘ΦΎ2023
```sql
SELECT i.id_Consumer, COUNT(*) AS total_purchases
FROM in_Purchases_from i
NATURAL JOIN payment p
WHERE EXTRACT(YEAR FROM p.p_date) = 2023
GROUP BY i.id_Consumer
HAVING COUNT(*) < 2;
```

---

## π”Ή Χ©ΧΧ™ΧΧΧ•Χ DELETE

### 1. ΧΧ—Χ™Χ§Χ Χ¨Χ›Χ™Χ©Χ•Χ ΧΧ”Χ™Χ§Χ‘ Χ©Χ‘Χ•Χ¦ΧΆΧ• ΧΧ¤Χ Χ™ 2023
```sql
DELETE FROM out_Purchase_for_the_winery
WHERE p_id IN (
  SELECT pfw.p_id
  FROM out_Purchase_for_the_winery pfw
  NATURAL JOIN payment p
  WHERE p.p_date < '2023-01-01'
);
```

### 2. ΧΧ—Χ™Χ§Χ Χ¦Χ¨Χ›Χ Χ™Χ ΧΆΧ Χ¤Χ—Χ•Χ ΧΦΎ2 Χ¨Χ›Χ™Χ©Χ•Χ
```sql
DELETE FROM Purchase_from_the_winery
WHERE id_Consumer IN (
  SELECT id_Consumer
  FROM in_Purchases_from
  GROUP BY id_Consumer
  HAVING COUNT(*) < 2
);
```

### 3. ΧΧ—Χ™Χ§Χ Χ¦Χ¨Χ›Χ Χ™Χ Χ©ΧΧ Χ¨Χ›Χ©Χ• Χ‘Χ©Χ Χ 2024
```sql
DELETE FROM Purchase_from_the_winery
WHERE id_Consumer IN (
  SELECT id_Consumer
  FROM in_Purchases_from
  NATURAL JOIN payment
  WHERE EXTRACT(YEAR FROM p_date) IS DISTINCT FROM 2024
);
```

---

## π”Ή Χ©ΧΧ™ΧΧΧ•Χ UPDATE

### 1. ΧΆΧ“Χ›Χ•Χ ΧΧ—Χ•Χ– Χ¨Χ•Χ•Χ— ΧΧΧ©Χ§Χ™ΧΆΧ™Χ ΧΆΧ ΧΧ©ΧΧ•Χ ΧΧΆΧ 10,000
```sql
UPDATE Investments
SET profit_Percentage = 15
WHERE id_Investor IN (
  SELECT ii.id_Investor
  FROM in_Investments ii
  NATURAL JOIN payment p
  WHERE p.p_sum > 10000
);
```

### 2. Χ”ΧΆΧΧΧ Χ©Χ›Χ¨ Χ‘ΦΎ10% ΧΧΆΧ•Χ‘Χ“Χ™Χ ΧΆΧ 3+ ΧΧΧ•Χ©Χ™ Χ©Χ›Χ¨
```sql
UPDATE employee
SET salary = salary * 1.10
WHERE e_id IN (
  SELECT e_id
  FROM salary
  GROUP BY e_id
  HAVING COUNT(*) >= 3
);
```

### 3. Χ”Χ•Χ¨Χ“Χ ΧΧ—Χ•Χ– ΧΧ΅ ΧΦΎ8% ΧΆΧ‘Χ•Χ¨ ΧΧ©ΧΧ•ΧΧ™Χ ΧΦΎ2022
```sql
UPDATE taxes
SET percent = 8
WHERE t_id IN (
  SELECT ot.t_id
  FROM out_taxes ot
  NATURAL JOIN payment p
  WHERE p.year = 2022
);
```

---

## π”Ή Χ©Χ™ΧΧ•Χ© Χ‘ΦΎROLLBACK
```sql
BEGIN;
UPDATE employee SET salary = salary * 1.10 WHERE e_id = 1;
ROLLBACK;
```

---

## π”Ή Χ©Χ™ΧΧ•Χ© Χ‘ΦΎCOMMIT
```sql
BEGIN;
UPDATE employee SET salary = salary * 1.10 WHERE e_id = 1;
COMMIT;
```

---

### 1. NOT NULL ΧΆΧ ΧΧΧ¨Χ™Χ Χ‘ΧΧ©ΧΧ•ΧΧ™Χ (payment.p_date)
```sql
ALTER TABLE payment
ALTER COLUMN p_date SET NOT NULL;

-- Χ Χ™Χ΅Χ™Χ•Χ Χ”Χ¤Χ¨Χ”
INSERT INTO payment (p_id, p_date, p_sum, in_or_out)
VALUES (501, NULL, 5000, 'in');
```

---

### 2. CHECK β€“ Χ΅Χ›Χ•Χ ΧΧ©ΧΧ•Χ Χ’Χ“Χ•Χ ΧΧΧ¤Χ΅ (payment.p_sum > 0)
```sql
ALTER TABLE payment
ADD CONSTRAINT check_positive_payment
CHECK (p_sum > 0);

-- Χ Χ™Χ΅Χ™Χ•Χ Χ”Χ¤Χ¨Χ”
INSERT INTO payment (p_id, p_date, p_sum, in_or_out)
VALUES (502, '2023-01-01', 0, 'in');
```

---

### 3. DEFAULT ΧΆΧ taxes.percent
```sql
ALTER TABLE taxes
ALTER COLUMN percent SET DEFAULT 17;

-- Χ‘Χ“Χ™Χ§Χ”
INSERT INTO taxes (t_id, taxname, principal_amount)
VALUES (999, 'ΧΧ΅ Χ Χ™Χ΅Χ™Χ•Χ', 10000);
```

```

*Χ”Χ¤Χ¨Χ•Χ™Χ§Χ Χ Χ‘Χ Χ” Χ‘Χ©Χ™ΧΧ•Χ© PostgreSQL Χ•Χ›ΧΧ™ pgAdmin 4.*
