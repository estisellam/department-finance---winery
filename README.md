# ××—×œ×§×ª ×›×¡×¤×™× - ×¤×¨×•×™×§×˜ ×‘×¡×™×¡×™ × ×ª×•× ×™×

**×©××•×ª ×”××’×™×©×•×ª:**  
- ×•×§× ×™×Ÿ ×”×“×¡ ××¡×ª×¨ â€“ 324966993  
- ×™×©×¨××œ×™ ×ª×”×™×œ×” â€“ 325119493  

**×©× ×”××¢×¨×›×ª:**  
× ×™×”×•×œ ×›×¡×¤×™× ×‘×™×§×‘  
**×”×™×—×™×“×” ×”× ×‘×—×¨×ª:**  
××—×œ×§×ª ×›×¡×¤×™×

---

## ×ª×•×›×Ÿ ×¢× ×™×™× ×™×

1. [××‘×•×](#××‘×•×)
2. [×ª×¨×©×™× ERD](#×ª×¨×©×™×-erd)
3. [×ª×¨×©×™× DSD](#×ª×¨×©×™×-dsd)
4. [×”×—×œ×˜×•×ª ×¢×™×¦×•×‘](#×”×—×œ×˜×•×ª-×¢×™×¦×•×‘)
5. [×©×™×˜×•×ª ×”×›× ×¡×ª × ×ª×•× ×™×](#×©×™×˜×•×ª-×”×›× ×¡×ª-× ×ª×•× ×™×)
6. [×’×™×‘×•×™ ×•×©×—×–×•×¨ × ×ª×•× ×™×](#×’×™×‘×•×™-×•×©×—×–×•×¨-× ×ª×•× ×™×)
7. [×©×œ×‘ ×‘ â€“ ×©××™×œ×ª×•×ª ×•×¢×“×›×•× ×™×](#×“×•×—-×¤×¨×•×™×§×˜--×©×œ×‘-×‘)
8. [×©×œ×‘ ×’- ××™× ×˜×’×¨×¦×™×” ×•××‘×˜×™×](#×“×•×—-×¤×¨×•×™×§×˜--×©×œ×‘-×’)


---

## ××‘×•×

### ×ª×™××•×¨ ×”× ×ª×•× ×™× ×”× ×©××¨×™× ×‘××¢×¨×›×ª:

1. **×˜×‘×œ×ª ×ª×©×œ×•××™× (payment)** â€“ ××–×”×”, ×¡×›×•×, ×ª××¨×™×š, ×¡×•×’ (×”×›× ×¡×”/×”×•×¦××”)
2. **×˜×‘×œ×ª ×¢×•×‘×“×™× (employee)** â€“ ××–×”×”, ×©×, ×ª××¨×™×š ×”×ª×—×œ×”, ×©×›×¨
3. **×˜×‘×œ×ª ×ª×§×¦×™×‘×™× (budgets)** â€“ ×©× ×”, ×¡×›×•×
4. **×˜×‘×œ×ª ×”×©×§×¢×•×ª (investments)** â€“ ××–×”×” ×”×©×§×¢×”, ××©×§×™×¢, ×¡×›×•×, ×ª×©×•××”
5. **×˜×‘×œ×ª ×¨×›×™×©×•×ª (purchases)** â€“ ××™×“×¢ ×¢×œ ××” × ×¨×›×©, ×›××”, ×•××™ ×¨×›×©
6. **×˜×‘×œ×ª ××™×¡×™× (taxes)** â€“ ×¡×›×•×, ××—×•×–, ×›×œ×œ×™× ××©×ª× ×™×
7. **×˜×‘×œ×ª ××©×›×•×¨×•×ª (salary)** â€“ ×‘×¨×•×˜×•, × ×˜×•, ×”×¤×¨×©×™× ××•×œ ××¡

### ×”×¤×•× ×§×¦×™×•× ×œ×™×•×ª ×”×¢×™×§×¨×™×ª ×‘××¢×¨×›×ª:

- ×§×™×©×•×¨ ×ª×©×œ×•× ×œ×”×©×§×¢×•×ª / ×¨×›×™×©×•×ª / ××©×›×•×¨×•×ª
- ×—×™×©×•×‘ ×©×›×¨ × ×˜×• ×œ××—×¨ × ×™×›×•×™ ××¡
- × ×™×”×•×œ ×ª×§×¦×™×‘ ××•×œ ×”×›× ×¡×•×ª ×•×”×•×¦××•×ª ×‘×¤×•×¢×œ
- ××¢×§×‘ ××—×¨ ×¨×›×™×©×•×ª ×œ×¤×™ ×¦×¨×›×Ÿ, ×›××•×ª ×•××—×™×¨
- ×—×™×©×•×‘ ××¡×™× ×œ×¤×™ ×—×•×§×™× ××•×ª×××™×

---

## ×ª×¨×©×™× ERD

![ERD](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/ERD.png?raw=true)

---

## ×ª×¨×©×™× DSD

![DSD](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/DSD.png?raw=true)

---

## ×”×—×œ×˜×•×ª ×¢×™×¦×•×‘

1. ×¨×™×›×•×– ×›×œ ×¡×•×’×™ ×”×ª×©×œ×•××™× ×‘×˜×‘×œ×” ××—×ª (`payment`) ×œ× ×™×”×•×œ ××—×™×“ ×•×§×œ.
2. ×§×™×©×•×¨ ×™×©×™×¨ ×‘×™×Ÿ `payment` ×œ×‘×™×Ÿ ×”×©×§×¢×•×ª, ×¨×›×™×©×•×ª ×•××©×›×•×¨×•×ª â€“ ×œ×©× ××¢×§×‘ ×‘×¨×•×¨ ××—×¨×™ ××§×•×¨ ×”×”×•×¦××”/×”×›× ×¡×”.
3. ×¤×™×¦×•×œ ×¨×›×™×©×•×ª ×œ×¨×›×™×©×•×ª ×›×œ×œ×™×•×ª ×•×¨×›×™×‘×™ ×¨×›×™×©×” â€“ ×œ×¤×™×¨×•×˜ ××œ× ×©×œ ××” × ×§× ×”.
4. ×”×¤×¨×“×ª ××©×›×•×¨×•×ª â€“ ×××¤×©×¨×ª ×œ×—×©×‘ ×©×›×¨ × ×˜×• ×œ×¤×™ ×—×•×§×™ ××¡ ××©×ª× ×™×.
5. ×©×™××•×© ×‘×˜×‘×œ×ª ×ª×§×¦×™×‘×™× â€“ ×œ××¢×§×‘ ×©× ×ª×™ ×•×œ×”×©×•×•××” ××•×œ ×”×•×¦××•×ª.
6. ×©××™×¨×ª ××—×•×–×™ ××¡ ×‘×˜×‘×œ×” × ×¤×¨×“×ª â€“ ×›×š × ×™×ª×Ÿ ×œ×¢×“×›×Ÿ ×—×•×§×™× ×‘×œ×™ ×œ×©× ×•×ª ××ª ××‘× ×” ×”×˜×‘×œ××•×ª.

---

## ×©×™×˜×•×ª ×”×›× ×¡×ª × ×ª×•× ×™×

### 1. ×©×™××•×© ×‘Ö¾Mockaroo

[mockarooFiles](https://github.com/estisellam/department-finance---winery/tree/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/mockarooFiles)

### 2. ×©×™××•×© ×‘Ö¾GENERATEDATA

[generatedataFiles](https://github.com/estisellam/department-finance---winery/tree/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/generatedataFiles)

### 3. ×¡×§×¨×™×¤×˜ ×‘Ö¾Python

[scripts folder](https://github.com/estisellam/department-finance---winery/tree/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/python_script)

---

## ×’×™×‘×•×™ ×•×©×—×–×•×¨ × ×ª×•× ×™×

![Backup](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%90/%D7%A6%D7%99%D7%9C%D7%95%D7%9D%20%D7%9E%D7%A1%D7%9A%202025-05-02%20%D7%91-9.34.22.png?raw=true)

**×§×•×‘×¥ ×”×’×™×‘×•×™:** `gibuy.sql`  
**×§×•×‘×¥ ×”×©×—×–×•×¨:** `insertTables.sql`  
×‘×•×¦×¢ ×©×™××•×© ×‘Ö¾pgAdmin ×œ×™×™×¦×•× ×•×©×—×–×•×¨ ×”× ×ª×•× ×™×.

---

# ×“×•×— ×¤×¨×•×™×§×˜ â€“ ×©×œ×‘ ×‘
## ğŸ”¹ ×©××™×œ×ª×•×ª select
### 1. ×›×œ ×”×¢×•×‘×“×™× ×©××—×¨××™× ×¢×œ ×”×©×§×¢×•×ª, ×××•×™× ×™× ×œ×¤×™ ××³-×‘×³
```sql
SELECT DISTINCT e.e_id, e.e_name
FROM employee e
NATURAL JOIN payment p
NATURAL JOIN in_Investments i
;ORDER BY e.e_name ASC
```
![](DBProject/×©×œ×‘%20×‘/×¦×™×œ×•×%20××¡×š%202025-05-11%20×‘-11.24.02select4select1.png)
![](DBProject/×©×œ×‘%20×‘/×¦×™×œ×•×%20××¡×š%202025-05-11%20×‘-11.24.16select4select1.png)
![](DBProject/×©×œ×‘%20×‘/×¦×™×œ×•×%20××¡×š%202025-05-11%20×‘-11.24.19select4select1.png)
---

### 2. ×›×œ ×”×¨×›×™×©×•×ª ×©×”×ª×‘×¦×¢×• ×‘×ª××¨×™×š 2024-06-19
```sql
SELECT p.p_id, p.p_date, i.id_Consumer
FROM payment p
NATURAL JOIN in_Purchases_from i
WHERE p.p_date = '2024-06-19';
```
![](DBProject/×©×œ×‘%20×‘/×¦×™×œ×•×%20××¡×š%202025-05-11%20×‘-11.30.40select2.png)
![](DBProject/×©×œ×‘%20×‘/×¦×™×œ×•×%20××¡×š%202025-05-11%20×‘-11.30.44select2.png)
---
### 3. ×›×œ ×”×¢×•×‘×“×™× ×©×”×ª×—×™×œ×• ×œ×¢×‘×•×“ ×œ×¤× ×™ 2020
```sql
SELECT e_id, e_name, job_start_date
FROM employee
WHERE job_start_date < '2020-01-01'
ORDER BY job_start_date ASC;
```
![](DBProject/×©×œ×‘%20×‘/×¦×™×œ×•×%20××¡×š%202025-05-11%20×‘-11.37.15select3.png)
![](DBProject/×©×œ×‘%20×‘/×¦×™×œ×•×%20××¡×š%202025-05-11%20×‘-11.37.18select3.png)
---

### 4. ×¡×š ×›×œ ×”×¡×›×•× ×©×œ ×ª×©×œ×•××™× × ×›× ×¡×™× ×‘×›×œ ×©× ×”
```sql
SELECT p_year, SUM(p_sum) AS total_income
FROM payment
WHERE in_or_out = 'in'
GROUP BY p_year
ORDER BY p_year;
```
![](DBProject/×©×œ×‘%20×‘/×¦×™×œ×•×%20××¡×š%202025-05-11%20×‘-11.38.02select4.png)
![](DBProject/×©×œ×‘%20×‘/×¦×™×œ×•×%20××¡×š%202025-05-11%20×‘-11.38.06select4.png)
### 5. ×¢×•×‘×“×™× ×¢× ×©×›×¨ ×’×‘×•×” ×•××—×¨×™×•×ª ×œÖ¾3+ ×ª×©×œ×•××™×
```sql
SELECT e.e_id, e.e_name, e.salary
FROM employee e
NATURAL JOIN payment p
GROUP BY e.e_id, e.e_name, e.salary
HAVING e.salary > 10000 AND COUNT(p.p_id) > 3;
```
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select05-before.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select05-run.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select05-result.png)

---

### 6. ×›×œ ×”×”×›× ×¡×•×ª ×œ×©× ×ª 2023
```sql
SELECT p.*
FROM payment p 
JOIN budgets b ON p.p_year = b.b_year 
WHERE p.p_year = 2023 AND p.in_or_out = 'in';
```
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select06-before.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select06-run.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select06-result.png)

---

### 7. ×¢×•×‘×“×™× ×¢× ×”×¤×¨×© ×©×›×¨ × ×˜×• â‰¤ 2000
```sql
SELECT e.e_id, e.e_name, e.salary, s.neto_salary
FROM employee e
NATURAL JOIN salary s
WHERE (e.salary - s.neto_salary) <= 2000;
```
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select07-before.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select07-run.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select07-result.png)

---

### 8. ×¦×¨×›× ×™× ×¢× ×¤×—×•×ª ×Ö¾2 ×¨×›×™×©×•×ª ×‘Ö¾2023
```sql
SELECT i.id_Consumer, COUNT(*) AS total_purchases
FROM in_Purchases_from i
NATURAL JOIN payment p
WHERE EXTRACT(YEAR FROM p.p_date) = 2023
GROUP BY i.id_Consumer
HAVING COUNT(*) < 2;
```
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select08-before.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select08-run.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/select08-result.png)

---

## ğŸ”¹ ×©××™×œ×ª×•×ª UPDATE

### 1. ×¢×“×›×•×Ÿ ××—×•×– ×¨×•×•×— ×œ××©×§×™×¢×™× ×¢× ×ª×©×œ×•× ××¢×œ 10,000
```sql
UPDATE Investments
SET profit_Percentage = 15
WHERE id_Investor IN (
  SELECT ii.id_Investor
  FROM in_Investments ii
  NATURAL JOIN payment p
  WHERE p.p_sum > 10000
);
```
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/update01-before.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/update01-run.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/update01-after.png)

---

### 2. ×”×¢×œ××ª ×©×›×¨ ×‘Ö¾10% ×œ×¢×•×‘×“×™× ×¢× 3+ ×ª×œ×•×©×™ ×©×›×¨
```sql
UPDATE employee
SET salary = salary * 1.10
WHERE e_id IN (
  SELECT e_id
  FROM salary
  GROUP BY e_id
  HAVING COUNT(*) >= 3
);
```
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/update02-before.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/update02-run.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/update02-after.png)

---

### 3. ×”×•×¨×“×ª ××—×•×– ××¡ ×œÖ¾8% ×¢×‘×•×¨ ×ª×©×œ×•××™× ×Ö¾2022
```sql
UPDATE taxes
SET percent = 8
WHERE t_id IN (
  SELECT ot.t_id
  FROM out_taxes ot
  NATURAL JOIN payment p
  WHERE p.p_year = 2022
);
```
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/update03-before.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/update03-run.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/update03-after.png)

---

## ğŸ”¹ ×©×™××•×© ×‘Ö¾ROLLBACK
```sql
BEGIN;
UPDATE employee
SET salary = salary + 123
WHERE e_id = 200;
ROLLBACK;
```
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/rollback-before.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/rollback-run.png)
![](DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/rollback-result.png)

---
## ğŸ”¹ ×©×™××•×© ×‘Ö¾COMMIT

```sql
BEGIN;
UPDATE employee
SET salary = salary + 123
WHERE e_id = 200;
COMMIT;
```

![×œ×¤× ×™](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/commit-before.png?raw=true)  
![×”×¨×¦×”](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/commit-run.png?raw=true)  
![×ª×•×¦××”](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/commit-result.png?raw=true)

---


## ×©××™×œ×ª×•×ª DELETE
### 1. ××—×™×§×ª ×¨×›×™×©×•×ª ××”×™×§×‘ ×©×‘×•×¦×¢×• ×œ×¤× ×™ ×©× ×ª 2023
```sql
BEGIN;
DELETE FROM out_Purchase_for_the_winery
WHERE p_id IN (
  SELECT pfw.p_id
  FROM out_Purchase_for_the_winery pfw
  NATURAL JOIN payment p
  WHERE p.p_date < '2023-01-01'
);
ROLLBACK;
```
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/delete%201.png)


### 2. ××—×™×§×ª ×›×œ ×”×¦×¨×›× ×™× ×©×‘×™×¦×¢×• ×¤×—×•×ª ×Ö¾2 ×¨×›×™×©×•×ª

```sql
BEGIN;
DELETE FROM Purchase_from_the_winery
WHERE id_Consumer IN (
  SELECT id_Consumer
  FROM in_Purchases_from
  GROUP BY id_Consumer
  HAVING COUNT(*) < 2
);
ROLLBACK;
```
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/delete%202.png)

### 3. ××—×™×§×ª ×¦×¨×›× ×™× ×©×œ× ×‘×™×¦×¢×• ××£ ×¨×›×™×©×” ×‘×©× ×ª 2024
```sql
BEGIN;
DELETE FROM Purchase_from_the_winery
WHERE id_Consumer IN (
  SELECT DISTINCT pf.id_Consumer
  FROM in_Purchases_from pf
  WHERE pf.id_Consumer NOT IN (
    SELECT pf2.id_Consumer
    FROM in_Purchases_from pf2
    NATURAL JOIN payment p
    WHERE EXTRACT(YEAR FROM p.p_date) = 2024
  )
);
ROLLBACK;
```
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/delete%203.png)
## ğŸ”¹ ××™×œ×•×¦×™×
### 1. ××™×œ×•×¥ NOT NULL ×¢×œ ×ª××¨×™×š ×‘×ª×©×œ×•××™×
```sql
ALTER TABLE payment
ALTER COLUMN p_date SET NOT NULL;

-- × ×™×¡×™×•×Ÿ ×”×¤×¨×”
INSERT INTO payment (p_id, p_date, p_sum, in_or_out)
VALUES (501, NULL, 5000, 'in');
```
---
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/Constraints1.png)
### 2. ××™×œ×•×¥ ×¢×œ ×©×›×¨- ×©×™×”×™×” ×¨×§ ×—×™×•×‘
```sql
-- ×”×•×¡×¤×ª ×”××™×œ×•×¥
ALTER TABLE employee
ADD CONSTRAINT check_positive_salary
CHECK (salary > 0);

-- × ×™×¡×™×•×Ÿ ×œ×”×¤×¨×ª ×”××™×œ×•×¥
INSERT INTO employee (e_id, e_name, start_date, salary)
VALUES (300, '×“×•×’××”', '2025-01-01', -1000);

```
---
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/Constraints%202.png)
### 3. ××™×œ×•×¥ ×¢×œ ××™×¡×™×- ×¢×¨×š ×‘×¨×™×¨×ª ×”××—×“×œ ×©×œ ×©×™×¢×•×¨ ×”××¡- 17%

```sql
-- ×”×•×¡×¤×ª ×”××™×œ×•×¥
ALTER TABLE taxes
ALTER COLUMN percent SET DEFAULT 17;

-- ×”×›× ×¡×ª ×¨×©×•××” ×œ×œ× ×¦×™×•×Ÿ ××—×•×– ×”××¡
INSERT INTO taxes (t_id, taxname, principal_amount)
VALUES (999, '××¡ × ×™×¡×™×•×Ÿ', 10000);

-- ×‘×“×™×§×ª ×”×¢×¨×š ×©× ×§×‘×¢
SELECT * FROM taxes WHERE t_id = 999;

```

---
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%91/Constraints%203.png)

# ×“×•×— ×¤×¨×•×™×§×˜ â€“ ×©×œ×‘ ×’
## ××’×£ ××¨×›×– ××‘×§×¨×™×- ERD
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%92/ERD_MERCAZ_MEVAKRIM.png?raw=true)

## ××’×£ ××¨×›×– ××‘×§×¨×™×- DSD
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%92/DSD%20mercaz%20mevacrim.jpeg?raw=true)

## ××™× ×˜×’×¨×¦×™×” -ERD
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%92/ERD%20Integration.png?raw=true)

## ××™× ×˜×’×¨×¦×™×”- DSD
![](https://github.com/estisellam/department-finance---winery/blob/main/DBProject/%D7%A9%D7%9C%D7%91%20%D7%92/DSD%20INTEGRETION.png?raw=true)


## ×”×—×œ×˜×•×ª ×©× ×¢×©×• ×‘×©×œ×‘ ×”××™× ×˜×’×¨×¦×™×”

### ×¢×§×¨×•× ×•×ª ×©×”× ×—×• ××•×ª× ×•:
- ×œ××—×“ ×˜×‘×œ××•×ª ×‘×¢×œ×•×ª ×ª×¤×§×™×“ ×“×•××” (×›×’×•×Ÿ payment).
- ×œ×©××•×¨ ×¢×§×‘×™×•×ª ×‘×©××•×ª ×¢××•×“×•×ª ×•××¤×ª×—×•×ª.
- ×œ×™×™×¢×œ ××ª ×”×¡×›×™××” ×›×“×™ ×œ×× ×•×¢ ×›×¤×™×œ×•×™×•×ª ×•×œ×”×§×œ ×¢×œ ×©×œ×™×¤×•×ª.

### ×˜×‘×œ××•×ª ×©××•×—×“×•:

#### 1. payment + payment:
×©×ª×™ ×”×˜×‘×œ××•×ª ×™×™×¦×’×• ×ª×©×œ×•××™× ××¡×•×’×™× ×©×•× ×™× â€“ ×©×›×¨ ×¢×•×‘×“×™×, ×¨×›×™×©×•×ª, ×”×›× ×¡×•×ª ××ª×™×™×¨×™× ×•×¢×•×“.
×”×Ÿ ××•×—×“×• ×œ×˜×‘×œ×” ××—×ª ×‘×©× payment.
× ×•×¡×¤×” ×¢××•×“×” ×—×“×©×”: payment_type ××©×¨ ××ª××¨×ª ××ª ××§×•×¨ ××• ×¡×•×’ ×”×ª×©×œ×•× (×œ×“×•×’××”: salary, tour_income, purchase, investment ×•×›×•').

#### 2. employee + guide:
××“×¨×™×›×™× ×”× ×ª×ª-×§×‘×•×¦×” ×©×œ ×¢×•×‘×“×™× ×•×œ×›×Ÿ ××™×—×“× ×• ××ª ×©×ª×™ ×”×˜×‘×œ××•×ª ×œ×˜×‘×œ×” ××—×ª ×‘×©× employee.
×‘×˜×‘×œ×” ×”×—×“×©×” × ×•×¡×¤×” ×¢××•×“×” role, ×¢× ×¢×¨×›×™× ×›×’×•×Ÿ guide, admin, worker ×•×›×•'.
×©×“×•×ª ×™×™×—×•×“×™×™× ×œ××“×¨×™×›×™× ×›××•:
- languages â€“ ×©×¤×•×ª ×©×”××“×¨×™×š ×“×•×‘×¨.
- guided â€“ ××¡×¤×¨ ×¡×™×•×¨×™× ×©×”×“×¨×™×š.

×”×•×›× ×¡×• ×œ×˜×‘×œ×” ×¢× ×¢×¨×›×™× ×¨×œ×•×•× ×˜×™×™× ×œ××“×¨×™×›×™×, ×•×¢×¨×›×™ ×‘×¨×™×¨×ª ××—×“×œ (NULL ××• ×¨×™×§) ×œ×©××¨ ×”×¢×•×‘×“×™×.

### ×§×©×¨×™× ×—×“×©×™× ×©× ×•×¦×¨×•:
payment ×§×™×‘×œ ×§×©×¨×™× ×—×“×©×™× ×œÖ¾visitor ×•×’× ×œÖ¾employee, ×ª×œ×•×™ ×œ×¤×™ payment_type.

employee ×§×•×©×¨ ×œÖ¾tour ×“×¨×š ×©×“×” role = guide, ×›×“×™ ×œ×”×•×‘×™×œ ×¡×™×•×¨×™×

## ×”×¡×‘×¨ ××™×œ×•×œ×™ ×©×œ ×”×ª×”×œ×™×š ×•×”×¤×§×•×“×•×ª

### ×©×™× ×•×™×™× ×‘×˜×‘×œ×ª employee

#### ×”×•×¡×¤×ª ×©×“×•×ª:
- `employee_role` (`TEXT`)  
  ××©××© ×œ×¦×™×•×Ÿ ×ª×¤×§×™×“ ×”×¢×•×‘×“ (×œ××©×œ: `"guide"`, `"worker"`).

- `languages` (`TEXT`)  
  ××¦×™×™×Ÿ ××™×œ×• ×©×¤×•×ª ××“×¨×™×š ××“×‘×¨. ×¨×œ×•×•× ×˜×™ ×¨×§ ×œ×¢×•×‘×“×™× ×‘×ª×¤×§×™×“ ××“×¨×™×š.

- `guided` (`BOOLEAN`)  
  ×©×“×” ××¡×¤×¨×™ ×œ×¦×™×•×Ÿ ×›××” ×”×“×¨×›×•×ª ×”×¢×•×‘×“ ×‘×™×¦×¢.

---

### ×©×™× ×•×™×™× ×‘×˜×‘×œ×ª ×”×ª×©×œ×•××™× (`payment`)

#### ×”×•×¡×¤×ª ×©×“×•×ª:
- `payment_type` (`TEXT`)  
  ××¦×™×™×Ÿ ××ª ××§×•×¨ ×”×ª×©×œ×•×, ×œ×“×•×’××”: `"visitor"`, `"employee"`, `"vehicle"`.

- `visitorid` (`INTEGER`)  
  ××–×”×” ××‘×§×¨ ×¢×‘×•×¨×• ×‘×•×¦×¢ ×”×ª×©×œ×•×, ×‘××§×¨×™× ×‘×”× ××§×•×¨ ×”×ª×©×œ×•× ×”×•× ××‘×§×¨.

#### ×”×•×¡×¤×ª ×§×©×¨×™× (Foreign Keys):
- `e_id` â†’ `employee(e_id)`  
  ×§×™×©×•×¨ ×©×œ ×ª×©×œ×•× ×œ×¢×•×‘×“ (×œ××©×œ ×›××©×¨ ×¢×•×‘×“ ×©×™×œ× ×¢×œ ×©×™×¨×•×ª ××¡×•×™×).

- `visitorid` â†’ `visitor(visitorid)`  
  ×§×™×©×•×¨ ×©×œ ×ª×©×œ×•× ×œ××‘×§×¨.

---

### ×©×™× ×•×™×™× ×‘×˜×‘×œ×ª ×”×¡×™×•×¨×™× (`tour`)

#### ×”×•×¡×¤×ª ×§×©×¨:
- `guide_id` â†’ `employee(e_id)`  
  ×›×œ ××“×¨×™×š ×¡×™×•×¨ ×—×™×™×‘ ×œ×”×™×•×ª ×¢×•×‘×“ ×§×™×™× ×‘×˜×‘×œ×ª `employee`.

---

### ×¡×™×›×•×

×©×™× ×•×™×™× ××œ×• ×××¤×©×¨×™×:
- ×”×‘×“×œ×” ×‘×™×Ÿ ×¡×•×’×™ ×¢×•×‘×“×™×.
- ××¢×§×‘ ××—×¨ ×©×¤×•×ª ×”×“×¨×›×” ×•× ×™×¡×™×•×Ÿ ×”×“×¨×›×ª×™.
- ×©×™×•×š ×ª×©×œ×•××™× ×œ××§×•×¨ (×¢×•×‘×“, ××‘×§×¨ ×•×›×•').
- ×”×’×“×¨×ª ×§×©×¨×™× ×‘×™×Ÿ ×¡×™×•×¨×™×, ××“×¨×™×›×™×, ×ª×©×œ×•××™× ×•××‘×§×¨×™×.


## Ö¿ ××‘×˜ 1 â€“ `view_tours_with_guide_info`

###  ×ª×™××•×¨ ××™×œ×•×œ×™:
××‘×˜ ×–×” ×××—×“ ××™×“×¢ ××˜×‘×œ×ª ×”×¡×™×•×¨×™× (tour) ×¢× ××™×“×¢ ×¢×œ ××“×¨×™×›×™× ××˜×‘×œ×ª ×”×¢×•×‘×“×™× (employee), ×•×›×•×œ×œ ×¨×§ ×¢×•×‘×“×™× ×‘×¢×œ×™ ×ª×¤×§×™×“ `guide`.
×”××‘×˜ ××¦×™×’: ××–×”×” ×¡×™×•×¨, ××—×™×¨, ×ª×™××•×¨, ×›××•×ª ××©×ª×ª×¤×™×, ×©× ×”××“×¨×™×š, ×©×¤×•×ª ×©×”×•× ×“×•×‘×¨, ×•×›××•×ª ×¡×™×•×¨×™× ×©×”×¢×‘×™×¨.

```sql
CREATE VIEW view_tours_with_guide_info AS
SELECT 
    t.tourid,
    t.price,
    t.description,
    t.amount,
    e.e_name AS guide_name,
    e.languages,
    e.guided_tours
FROM 
    tour t
JOIN 
    employee e ON tourid = e.e_id
WHERE 
    e.employee_role = 'guide';

```


---

###  ×©××™×œ×ª×” 1:
#### ×ª×™××•×¨:
××¦×™×’×” ××ª ×¡×š ×”×”×›× ×¡×•×ª ××›×œ ×¡×™×•×¨ (××—×™×¨ * ×›××•×ª ××©×ª×ª×¤×™×) ×¢×‘×•×¨ ×›×œ ××“×¨×™×š.
```sql
SELECT 
    guide_name,
    SUM(price * amount) AS total_income
FROM 
    view_tours_with_guide_info
GROUP BY 
    guide_name;
```

![](DBProject/×©×œ×‘%20×’/m1.1.png)
---

###  ×©××™×œ×ª×” 2:
#### ×ª×™××•×¨:
××¦×™×’×” ××ª ×›×œ ×”×¡×™×•×¨×™× ×©××—×™×¨× ×’×‘×•×” ××”×××•×¦×¢ ×‘×›×œ×œ ×”×¡×™×•×¨×™×.
```sql
SELECT * 
FROM view_tours_with_guide_info
WHERE price > (
    SELECT AVG(price) 
    FROM view_tours_with_guide_info
);
```

![](DBProject/×©×œ×‘%20×’/m1.2.png)

---

##  ××‘×˜ 2 â€“ `view_employee_payments`

###  ×ª×™××•×¨ ××™×œ×•×œ×™:
××‘×˜ ×–×” ×××—×“ ×‘×™×Ÿ ×˜×‘×œ×ª ×”×ª×©×œ×•××™× (payment) ×•×˜×‘×œ×ª ×”×¢×•×‘×“×™× (employee), ×•××¦×™×’ ××™×“×¢ ××œ× ×¢×œ ×›×œ ×ª×©×œ×•× ×©×‘×•×¦×¢ ×œ×¢×•×‘×“:
××–×”×” ×ª×©×œ×•×, ×ª××¨×™×š, ×¡×›×•×, ×¡×•×’ ×ª×©×œ×•×, ×”×× ××“×•×‘×¨ ×‘×”×›× ×¡×” ××• ×”×•×¦××”, ×©× ×”×¢×•×‘×“ ×•×ª×¤×§×™×“×•.

```sql
CREATE VIEW view_employee_payments AS
SELECT 
    p.p_id,
    p.p_date,
    p.p_sum,
    p.payment_type,
    p.in_or_out,
    e.e_name AS employee_name,
    e.employee_role
FROM 
    payment p
JOIN 
    employee e ON p.e_id = e.e_id;

```


---

###  ×©××™×œ×ª×” 1:
#### ×ª×™××•×¨:
××¦×™×’×” ××ª ×›×œ ×ª×©×œ×•××™ ×”×©×›×¨ (`salary`) ×©×‘×•×¦×¢×• ×œ×¢×•×‘×“×™×, ××”×’×‘×•×” ×œ× ××•×š.
```sql
SELECT 
    employee_name,
    employee_role,
    p_sum,
    p_date
FROM 
    view_employee_payments
WHERE 
    payment_type = 'salary'
ORDER BY 
    p_sum DESC;
```

![](DBProject/×©×œ×‘%20×’/m2.1.png)

---

###  ×©××™×œ×ª×” 2:
#### ×ª×™××•×¨:
××¦×™×’×” ××ª ×›×œ ×”×ª×©×œ×•××™× (×”×›× ×¡×•×ª ×•×”×•×¦××•×ª) ×›××©×¨ ×¡×›×•××™ ×”×”×•×¦××•×ª ××•×¦×’×™× ×›×¡×›×•× ×©×œ×™×œ×™ â€“ ×œ×¦×•×¨×š × ×™×ª×•×— ×ª×§×¦×™×‘×™.
```sql
SELECT 
    p_date,
    employee_name,
    employee_role,
    payment_type,
    in_or_out,
    CASE 
        WHEN in_or_out = 'in' THEN p_sum
        ELSE -p_sum
    END AS signed_amount
FROM 
    view_employee_payments
ORDER BY 
    p_date DESC;
```
![](DBProject/×©×œ×‘%20×’/m2.2.png)


